<!doctype html>
<html>
<head>
  <meta charset=utf-8>
  <link rel=stylesheet href="../style.css">
  <title>Maxime Euzi√®re</title>
</head>
<body>
  <div class=menu>
    <div class=header>
      <h1>Maxime Euzi√®re</h1>
      Front-end experiments
      <br>
      HTML / CSS / JS
      <br>
      <br>
      <a href="../fr.html">Home</a>
      <a href="../articles/fr.html">Articles</a>
      <a href="../techwatch/fr.html">Tech watch</a>
      <a href="../projects/fr.html">Projects / experiments</a>
      <a href="../talks/fr.html">Talks</a>
      <a href="../golfing/fr.html" class=active>JS Code golfing</a>
    </div>
    <div class=footer>¬© 2014 - <a href="../cv/cv-fr.html" target=_blank>CV</a> - <a href=en.html><img src="../english.png" alt="English version" title="English version" class=pulse></a></div>
  </div>
  <div class=body>
  <div class=intro>
  <p>Le <b>code golfing</b> est une activit√© consistant √† impl√©menter un algorithme avec un code source le plus court possible.</p>
  <p>De nombreux <a href=//golf.shinh.org/ target=_blank>concours</a> proposent de cr√©er des d√©mos JavaScript en moins de <a href=//140byt.es target=_blank>140 caract√®res</a>, <a href=//js1k.com target=_blank>1ko</a>, <a href=//js13kgames.com/ target=_blank>13ko</a>, <a href="http://www.pouet.net/prodlist.php?type%5B%5D=32b&type%5B%5D=64b&type%5B%5D=128b&type%5B%5D=256b&type%5B%5D=512b&type%5B%5D=1k&type%5B%5D=4k&type%5B%5D=8k&type%5B%5D=16k&type%5B%5D=32k&type%5B%5D=40k&type%5B%5D=64k&type%5B%5D=80k&type%5B%5D=96k&type%5B%5D=100k&type%5B%5D=128k&type%5B%5D=256k&type%5B%5D=artpack&type%5B%5D=bbstro&type%5B%5D=cracktro&type%5B%5D=demo&type%5B%5D=demopack&type%5B%5D=demotool&type%5B%5D=dentro&type%5B%5D=diskmag&type%5B%5D=fastdemo&type%5B%5D=game&type%5B%5D=intro&type%5B%5D=invitation&type%5B%5D=liveact&type%5B%5D=musicdisk&type%5B%5D=procedural+graphics&type%5B%5D=report&type%5B%5D=slideshow&type%5B%5D=votedisk&type%5B%5D=wild&platform%5B%5D=JavaScript&page=1" target=_blank>etc.</a></p>
  <p>Plusieurs d√©veloppeurs ont des sites d√©di√©s au code golfing JS: <a href=//aem1k.com/ target=_blank>aem1k</a>, <a href=://www.p01.org/releases/ target=_blank>p01</a>, etc.</p>
  <p>Cette page rassemble mes premi√®res r√©alisations.</p>
</div>

<div class=section>
	<h2>Hello World en ASCII-art</h2>
	<h3>f√©vrier 2014</h3>
	<p>Challenge propos√© sur stackexchange. Meilleure solution JS: 117 octets (√† ex√©cuter dans une console JS):</p>
  <pre>for(i=s="";l=[43117609029,64070269789,46349920852,46890400349][i++];)for(j=0,s+="\n";c=l.toString(2)[j++];)s+=" #"[c]</pre>
  <p>Meilleure solution ES6 (fonctionne sur Firefox): 108 octets:</p>
  <pre>[,0xa0a028045,0xeeae2bb5d,0xacaabaa54,0xaeae2ba5d].map(a=>a.toString(2).replace(/./g,b=>' #'[b])).join('\n')</pre>
	<a href=//codegolf.stackexchange.com/questions/20209/ascii-art-hello-world/20568#20568 target=_blank>lien</a>
</div>

<div class=section>
	<h2>Hex</h2>
	<h3>janvier 2014</h3>
	<p>Un visualiseur / √©diteur hexad√©cimal en 256b / 1kb.</p>
	<b>Site:</b> <a href=//xem.github.io/hex target=_blank>http://xem.github.io/hex</a>
</div>

<div class=section>
	<h2>Une fonction JS qui dit laquelle/lesquelles de ses lignes ont √©t√© supprim√©es</h2>
	<h3>d√©cembre 2013</h3>
	<p>Challenge propos√© sur stackexchange</p>
  <p>Meilleure solution JS d√©tectant si 0 ou 1 ligne a √©t√© supprim√©e: 78 octets</p>
  <pre>(function(n){
a=n-=1
n-=2
+3
+4;if(this.a)return 5
return n;var a
})()</pre>
	<a href=//codegolf.stackexchange.com/questions/16349/write-a-function-that-tells-you-which-of-its-lines-has-been-removed/16424#16424 target=_blank>lien</a>
  <p>Meilleure solution JS d√©tectant si 0 ou 1 ou 2 lignes ont √©t√© supprim√©es: 213 octets</p>
  <pre>(function(r){
r.shift();
r.splice(r.indexOf(2),1)
r.splice(r.indexOf(3),1);a=b=1;if(this.a&&this.b)return r
var a;r.splice(r.indexOf(4),1);b=1;if(this.b)return r
var b;r.pop();return r[0]?r:0
})([1,2,3,4,5])</pre>
	<a href=//codegolf.stackexchange.com/questions/16810/write-a-function-that-tells-you-which-two-of-its-lines-has-been-removed/16823#16823 target=_blank>lien</a>
</div>

<div class=section>
	<h2>Paste</h2>
	<h3>d√©cembre 2013</h3>
	<p>Un service de copier-coller (comme pastebin) en 140 caract√®res.</p>
	<p>Il suffit d'√©crire ou de copier-coller n'importe quoi dans la page, et de partager l'URL.</p>
	<b>Site:</b> <a href=//xem.github.io/paste target=_blank>http://xem.github.io/paste</a>
  <br>
	<b>Github:</b> <a href=//github.com/xem/paste target=_blank>https://github.com/xem/paste</a>
</div>

<div class=section>
	<h2>MiniCodeEditor</h2>
	<h3>mars √† d√©cembre 2013</h3>
	<p>Un bac-√†-sable HTML/CSS/JS (comme codepen ou jsfiddle) en seulement 161+ caract√®res.</p>
	<b>Site Web:</b> <a href=//xem.github.io/miniCodeEditor target=_blank>http://xem.github.io/miniCodeEditor</a>
</div>

<div class=section>
	<h2>MiniMinifier</h2>
	<h3>mars √† d√©cembre 2013</h3>
	<p>Des minifieurs de code HTML, CSS, JS en seulement 128+ caract√®res</p>
  <b>Site Web:</b> <a href=//xem.github.io/miniMinifier target=_blank>http://xem.github.io/miniMinifier</a>
</div>

<div class=section>
	<h2>Touches enfonc√©es</h2>
	<h3>septembre √† d√©cembre 2013</h3>
	<p>Un moyen de savoir √† tout moment si une touche du clavier est en train d'√™tre enfonc√©e, en seulement 60 caract√®res.</p>
	<pre>k={};onkeydown=onkeyup=function(e){k[e.keyCode]=!!e.type[5]}</pre>
	<p>
    Pour l'utiliser, il suffit de choisir "n" - le keyCode d'une touche de clavier - et de tester k[n]. Celui-ci est vrai quand la touche en question est press√©e, et faux quand elle ne l'est plus.
    <br>
    (Si elle n'a jamais √©t√© press√©e, k[n] sera undefined, ce qui est consid√©r√© comme "false" dans un test.)
    <br>
    <button onclick="source_touches_enfoncees.style.display='block';this.style.display='none'">Voir le code source</button>
  <br>
  <pre id=source_touches_enfoncees style="display:none">// Initialize the global k (the array representing the keys currently pressed).
// Also works with k = [].
k = {};

// Add two event handlers to the window object:
// window.onkeydown and window.onkeyup.
// They don't need the window prefix (it's implicit)
// And they both get the same callback function
onkeydown = onkeyup = function(e){

  // On keydown, e.type == "keydown", and e.type[5] == "w" (truthy)
  // On keyup, e.type == "keyup", and e.type[5] == undefined (falsy)
  // !! converts e.type[5] to a boolean. It can be removed but it's a little dirtier.
  k[e.keyCode] = !!e.type[5];

}</pre>
  <br>
  <b>D√©mo:</b> Voici l'√©tat de k en temps r√©el. Enfoncez des touches du clavier pour le faire √©voluer.
    <script>
      k=[];onkeydown=onkeyup=function(e){k[e.keyCode]=!!e.type[5];demo_touches_enfoncees.innerHTML="k = ["+k+"]"}
    </script>
    <div class=demo><pre id=demo_touches_enfoncees>k = [ ]</pre></div>
  </p>
</div>

<div class=section>
	<h2>MiniDemineur</h2>
	<h3>d√©cembre 2013</h3>
  <p>Un jeu de d√©mineur en moins de 512 octets</p>
  <pre>&lt;table border id=t>&lt;script>b=[v=[]];f=[l=g=0];n=[];function r(d){for(M=!l;M;l=g)for(a=M=H="";s>++a;)for(j=s,H+="&lt;tr>";~--j;H+="&lt;th onclick=b[i="+I+"]?g--:v[i]=1;r() oncontextmenu=for(f["+I+"]^=g=1,a=0;a&lt;s*s;)g&=b[a]^!f[a++];return!!r() "+(v[I]|g||"bgcolor=tan")+">"+(f[I]?"‚öë":b[I]&g?"üí£":v[I]|g&&n[I]||"‚ÄÅ‚ÄÇ"))for(I=a*s+j,T=d?b[I]=.1>Math.random():0,x=2;~x--;)for(y=2;~y--;~B&&B&lt;s?(n[C]=~~n[C]+T)||v[I]|b[I]|!v[C]?0:v[I]=M=1:0)B=j+y,C=(a+x)*s+B;t.innerHTML=H}r(s=9)&lt;/script></pre>
  Site Web: <a href=//xem.github.io/MiniSweeper target=_blank>http://xem.github.io/MiniSweeper</a>
</div>

<div class=section>
	<h2>Un programme JS qui affiche tous les caract√®res ASCII qu'il ne contient pas</h2>
  <p>Challenge post√© sur stackexchange. Meilleure solution JS: 88 caract√®res.</p>
	<h3>novembre 2013</h3>
  <pre>alert("BCDFGHIJKMNPQUVXYZ".toLowerCase())// !#$%&'*+,-0123456789:;<=>?@[\]^_`{|}~AERTOWS</pre>
  <p>(Affiche "bcdfghijkmnpquvxyz")</p>
  Post: <a href=//codegolf.stackexchange.com/questions/12368/print-every-character-your-program-doesnt-have/15497#15497 target=_blank>lien</a>
</div>

<div class=section>
	<h2>Quelle quantit√© de code JavaScript peut-on ex√©cuter en 140 caract√®res?</h2>
	<h3>novembre 2013</h3>
  <p>La r√©ponse est: 190 caract√®res!</p>
  <p>Sur <a href=//140byt.es target=_blank>140byt.es</a>, le but est d'√©crire des fonctions JavaScript qui tiennent dans un tweet, autrement dit dans 140 caract√®res.</p>
  <p>Jusqu'√† maintenant, ces fonctions ont toujours √©t√© √©crites "en clair", en caract√®res ASCII. Mais un tweet peut contenir 140 caract√®res Unicode, y compris des caract√®res "astraux", utilisant 4 octets.</p>
  <p>J'ai donc eu l'id√©e d'exploiter cet encodage (UTF-16) pour compresser du code JavaScript "trop long", et ins√©rer ce code compress√© dans une expression JavaScript capable de le d√©compresser et de l'ex√©cuter, tout en respectant la limite de 140 caract√®res.</p>
  <p>Voici la repr√©sentation binaire d'un caract√®re UTF-16 "astral". Il est compos√© de deux moiti√©s ("surrogates") de 16 bits, dont les 6 premiers bits sont fix√©s. Les 10 derniers bits (repr√©sent√©s par des "x") peuvent prendre n'importe quelle valeur.</p>
  <pre>110110xx xxxxxxxx  110111xx xxxxxxxx</pre>
  <br>
  <p>Voici la repr√©sentation binaire de la cha√Æne "ABCD" (en ASCII). Chaque caract√®re est encod√© sur 1 octet.<br>(En fait, 7 bits suffisent pour encoder un caract√®re ASCII, mais dans les encodages modernes, le 8√®me bit est laiss√© √† 0).</p>
  <pre>01000001 01000010 01000011 01000100</pre>
  <br>
  <p>L'id√©e est donc de n'utiliser que des caract√®res UTF-16 astraux, en stockant un caract√®re ASCII √† la fin de chaque surrogate.<br>Voici la cha√Æne "ABCD" encod√©e dans 2 caract√®res UTF-16 (avec 2 caract√®res en un, on a donc une compression de 50% !):</p>
  <pre>11011000 01000001 11011100 01000010  11011000 01000011 11011100 01000100 ==> †ëÇ†±Ñ
         |--A---|          |--B---|           |--C---|          |--D---|    (ABCD encod√©)</pre>
  <br>
  <p>Voici un encodeur (de 129 caract√®res) permettant de faire cette compression:</p>
  <pre>z=function(b,c,a,f,e){c="";f=String.fromCharCode;for(a=0;190>a;a+=2)c+=f(55296+b[e="charCodeAt"](a))+f(56320+b[e](a+1));return c}</pre>
  <button onclick="source_encoder190.style.display='block';this.style.display='none'">Voir le code source</button>
  <pre id=source_encoder190 style="display: none">/**
* @param b: the input string (in ASCII)
* @param c, a, f: placeholders
*/
z = function(b, c, a, f){
    
  // Return string
  c="";
  
  // Shortcut for "String.fromCherCode"
  f = String.fromCharCode;
  
  // Loop on all the ASCII characters
  for(a = 0; 190 > a; a += 2)
  
    // Append an UTF-16 (two surrogates) to the return string
    c += f(0xD800 + b.charCodeAt(a)) + f(0xDC00 + b.charCodeAt(a + 1));
  
  // Return
  return c
}</pre>
  <script>compressAscii190=function(b,c,a){c="";if(b.length%2)b+=" ";f=String.fromCharCode;for(a=0;b.length>a;a+=2)c+=f(55296+b[e="charCodeAt"](a))+f(56320+b[e](a+1));return c}</script>
  <br>
  <p>Et voici le code permettant de d√©compresser et ex√©cuter le code JavaScript original (merci √† <a href=//twitter.com/subzey target=_blank>@subzey</a> pour son aide):</p>
  <pre>// remplacer "†ëÇ†±Ñ" par votre cha√Æne encod√©e
eval(unescape(escape("†ëÇ†±Ñ").replace(/uD./g,'')))</pre>
  <button onclick="source_decoder190.style.display='block';this.style.display='none'">Voir le code source</button>
  <pre id=source_decoder190 style="display: none">// First, we need to know how JavaScript handles escaped characters:
// ASCII characters are escaped as: %XX (XX is an hexadecimal value)
// UTF-16 surrogates are escaped as: %uYYXX (YYXX is an hexadecimal value, XX is the last byte)
// The escape() function does this, unescape() does the opposite.

// Encoded string
var encoded = "†ëÇ†±Ñ";

// Escape it
var escaped = escape(encoded); // --> "%uD841%uDC42%uD843%uDC44"

// Remove the 3 characters after each "%" ("uYY")
var replaced = escaped.replace(/uD./g,''); // --> "%41%42%43%44"

// Unescape it
var unescaped = unescape(replaced); // --> "ABCD" (the decoded string)

// Eval
eval(unescaped); // Tries to execute the decoded string.
  </pre>
  <br>
  <p>Ce d√©compresseur-ex√©cuteur mesure seulement 45 caract√®res. On peut donc ex√©cuter <b>190</b> ((140 - 45) x 2) caract√®res JS dans un seul tweet.</p>
  <br>
  <hr>
  <br>
  <p><b>D√©mo:</b></p>
  Code JavaScript:
  <br>
  <br>
  <textarea rows=3 id=compress>alert("Ce script mesure cent quatre-vingt-dix caract√®res et ne rentre h√©las pas dans un tweet... Mais si on le compresse en quatre-vingt-quinze caract√®res unicode, cela devient possible !");</textarea>
  <br>
  <script>longueur_js = 0;</script>
  <button onclick="alert(compress.value.length + ' caract√®res')">1: Compter (ASCII)</button> &nbsp; > &nbsp; 
  <button onclick="eval(compress.value)">2: Ex√©cuter</button> &nbsp; > &nbsp; 
  <button onclick="longueur_js=compress.value.length;compress.value='eval(unescape(escape(\''+compressAscii190(compress.value)+'\').replace(/uD./g,\'\')))'">3: Compresser</button> &nbsp; > &nbsp; 
  <button onclick="alert((Math.ceil(longueur_js/2)+45) + ' caract√®res')">4: Compter (UTF-16)</button> &nbsp; > &nbsp; 
  <button onclick="eval(compress.value)">5: Ex√©cuter</button>
</div>

<div class=section>
	<h2>Escargot</h2>
	<h3>octobre 2013</h3>
	<p>Une fonction g√©n√©rant une matrice "en escargot", en 133 caract√®res</p>
	<pre>s=function(e,c,d,b,f,h,g){c=[[]];d=1;b=h=0;for(f=-1;e;e--){for(g=1;g<2*e;g++)g>e?b+=d:f+=d,c[b]||(c[b]=[]),c[b][f]=++h;d=-d}return c}</pre>
  <button onclick="source_escargot.style.display='block';this.style.display='none'">Voir le code source</button>
  <br>
  <pre id=source_escargot style="display:none">/**
* Snail
* @param n: the size of the matrix (n*n)
* @return: a 2D array with integers
*/

s = function(n,a,d,x,y,c,i){
  
  // a is the result matrix
  a = [[]];
  
  // d is the direction: right, bottom = 1; left, top = -1
  d = 1;
  
  // c is the counter value.
  c = 0;
  
  // x and y are the coordinates of the number in the matrix
  x = 0;
  y = -1;

  // Loop while n decrements
  for(; n; n--){

    // The two following loops are merged in the minified code:
    
    // fill n columns
    for(i = 0; i < n; i++){
      
      y += d;
      a[x][y] = ++c;
    }
    
    // fill n-1 lines 
    for(i = 0; i < n - 1; i++){
      
      x += d;
      if(!a[x]){
        a[x] = [];
      }
      a[x][y] = ++c;
    }

    // change direction
    d = -d;
  }
  
  return a;
}</pre>
  <br>
  <b>D√©mo</b>:
  <br>
  Taille: <input id=taille_escargot value=8 size=2> <button id=button_escargot>G√©n√©rer</button>
  <script>
    snail=function(e,c,d,b,f,h,g){c=[[]];d=1;b=h=0;for(f=-1;e;e--){for(g=1;g<2*e;g++)g>e?b+=d:f+=d,c[b]||(c[b]=[]),c[b][f]=++h;d=-d}return c}
    button_escargot.onclick = function(){
      var size = parseInt(taille_escargot.value);
      if(size > 0){
        demo_escargot.style.display = "block";
        var matrix = snail(size);
        var html = "<table style='width:auto;table-layout:fixed;background:#fff' border=rules>";
        var i, j;
        for(i = 0; i < size; i++){
          html += "<tr>";
          for(j = 0; j < size; j++){
            html += "<td style='padding:5px;text-align:center'>" + matrix[i][j] + "</td>";
          }
          html += "</tr>";
        }
        html += "</table>";
        demo_escargot.innerHTML = html;
      }
    }
  </script>
  <div class=demo id=demo_escargot style="display:none"></div>
</div>

<div class=section>
	<h2>MiniGameOfLife</h2>
	<h3>septembre 2013</h3>
	<p>Un moteur de jeu de la vie en seulement 130 caract√®res.</p>
  <pre>g=function(f,c,g,d,e,b,h){g=[];e=[c+1,c,c-1,1];for(b=c*c;b--;g[b]=3==d||f[b]&&2==d,d=0)for(h in e)d+=f[b+e[h]]+f[b-e[h]];return g}</pre>
  <button onclick="source_miniGameOfLife.style.display='block';this.style.display='none'">Voir le code source</button>
  <br>
  <pre id=source_miniGameOfLife style="display:none">// @param s: current state of the grid
// @param d: size of the grid (d*d)
// @param n: placeholder
// @param k: placeholder
// @param m: placeholder
// @param i: placeholder
// @param j: placeholder
g = function(s, d, n, k, m, i, j){
  for(
    n = [],                           // Initialize next state
    m = [d + 1, d, d - 1, 1],         // Initialize a list of the neighbours offsets
    i = d * d;                        // For each cell
    i--;
    n[i] = k == 3 || s[i] && k == 2,  // Set next state (live if it has 3 neighbours or lives and has 2 neighbours)
    k = 0                             // Reset the count of living neighbours
  )
  for(j in m)                         // for each neighbour offset
    k += s[i + m[j]] + s[i - m[j]]    // count the living neighbours (at positions -offset and +offset)
  return(n)                           // return the next state
}</pre>
  <br>
	<b>Site Web:</b> <a href=//xem.github.io/miniGameOfLife target=_blank>http://xem.github.io/miniGameOfLife</a>
</div>

<div class=section>
	<h2>Manipulations binaires</h2>
	<h3>septembre 2012</h3>
	<p>
		Les op√©rations binaires en JavaScript sont des pi√®ges. J'ai d'ailleurs √©crit un post wtfjs √† ce sujet. (<a href="http://wtfjs.com/2012/09/19/Hexadecimal-weirdness" target=_blank>lien</a>)
		<br>
    C'est pourquoi j'ai √©crit une mini lib de 137 caract√®res qui permet de faire correctement des "left shift", "right shift", et d'extraire quelques bits d'un nombre.
    <pre>M=Math;function l(a,b){return a*M.pow(2,b)}function r(a,b){return M.floor(a/M.pow(2,b))}function b(a,b,c){return r(a,b)&M.pow(2,c-b+1)-1}</pre>
    <button onclick="source_binaire.style.display='block';this.style.display='none'">Voir le code source</button>
  <br>
  <pre id=source_binaire style="display:none">// M is a shortcut for Math
M = Math;

// Left shift
// a << b is equivalent to a * (2 ^ b)
function l(a,b){
  return a * M.pow(2, b);
}

// Right shift
// a >> b is equivalent to a / (2 ^ b)
function r(a,b){
  return M.floor(a / M.pow(2, b));
}

// Bit extraction
// returns a's bits from b to c
// i.e. the last (c - b + 1) bits of (a >> b)
function b(a,b,c){
  return r(a,b) & M.pow(2, c - b + 1) - 1;
}</pre>
	</p>
</div>
  </div>
</body>
</html>