<!doctype html>
<meta charset=utf-8>
<meta name="viewport" content="width=device-width, user-scalable=no">
<html>
<head>
<link rel=stylesheet href="../style.css?v=2024-07">
<title>Maxime Euzière</title>
<base target=_blank>
</head>
<body>

<style>
.twitter-tweet { margin: 30px 0 !important; border: 3px solid #ccc; border-radius: 30px; overflow: hidden; transform: scale(.95)}
ul { padding-left: 15px }
</style>

<div class="wrapper">

<header></header>

<div id=menu></div>

<main>

<div class=section id=codegolfctober18>

<h2>JS13k'24: GREAT PLUMBER 65, EMOJIPHOBIA & O HIII BAD SKATEPARK</h2>
<br><h3>August-September 2024</h3>
<br><hr><br>
<img src="images/js13k24/cover.jpg" width=500>
<br>
<br>
<hr>
<br>
Hello! It's the 13th edition of JS13KGames. The theme is <b>Triskaidekaphobia</b> (the phobia of number 13).
<br>
<br>
<hr>
<br>
<h3>TL;DR</h3>

<p>This year I released 3 entries:
<p>- <a href="https://dev.js13kgames.com/2024/games/great-plumber-65">GREAT PLUMBER 65</a> (a 3D platformer tech demo inspired by a childhood game, ranked ...th) - <a href="https://github.com/xem/js13k24">Github</a>

<br>- <a href="https://dev.js13kgames.com/2024/games/emojiphobia">EMOJIPHOBIA</a> (a quiz game about phobias... and emoji, with more than 280 to discover, ranked ...th) - <a href="https://github.com/xem/js13k24-phobia">Github</a>

<br>- <a href="https://dev.js13kgames.com/2024/games/o-hiii-bad-skatepark">O HIII BAD SKATEPARK</a> (a "Line Rider" clone with skates and extra challenges, ranked ...th) - <a href="https://github.com/xem/js13k24-skate">Github</a>

<p>... and 3 new tools:

<p>- <a href="https://xem.github.io/pxtex/">Pxtex</a>: a random pixelized texture generator

<br>- <a href="https://xem.github.io/microW/">MicroW</a>: a basic WebGL renderer in less than 1kb

<br>- <a href="https://github.com/xem/miniGameTemplate">MiniGameTemplate</a>: a modern, editable HTML5 game template in just 100 lines of code


<br>
<br>
<hr>
<br>
<h2>The full story (with spoilers)</h2>
<br>
<hr>
<br>
<p><b>SUMMARY</b>
<p>- <a href="#intro" target=_self>Introduction</a>
<br>- <a href="#game1" target=_self>Days 1-11: GREAT PLUMBER 65</a>
<br>- <a href="#game2" target=_self>Days 12-21: EMOJIPHOBIA</a>
<br>- <a href="#game3" target=_self>Days 22-31: O HIII BAD SKATEPARK</a>
<br>- <a href="#conclusion" target=_self>Conclusion</a>
<br>
<br>
<hr>
<br>
<p><b id=intro>Introduction</b>

<p>At the beginning of July 2024, I hadn't really been able to enjoy coding for a couple years, and had serious doubts about competing in js13kgames this year. Focusing on code had become too hard for me.
<p>By chance, I stumbled upon <a href="https://www.youtube.com/watch?v=b0hL4mJInm0">JaidenAnimations video "I found out I have ADHD."</a>, which made me decide to consult a specialist, get an actual ADHD diagnosis, and the appropriate medication.
<p>And it was exactly what I needed. After a couple days, my brain was fixed and I was again (actually, more than ever) able to think, focus and create stuff, many hours a day... and do it with actual pleasure!
<p>JS13K 2024 is officially uncancelled! Get ready for an unusually productive summer...
<p>While waiting for JS13k to start, I spent most of July replaying every single JS game I had made for the past 10 years, <a href="https://x.com/MaximeEuziere/status/1807668217734660294">in the form of an X thread</a>. The playthroughs durations range from a couple minutes to almost <a href="https://www.youtube.com/watch?v=nznC5jv0Vg8">3 hours</a> (for my 2021 entry LOSSST).
<blockquote class="twitter-tweet" data-theme="dark" data-media-max-width="560"><p lang="en" dir="ltr">On august 13th starts the 13th edition of <a href="https://twitter.com/js13kGames?ref_src=twsrc%5Etfw">@js13kGames</a>.<br>I&#39;ve also been making code golfed JS games for 10 years.<br>Instead of a tips/tools thread, I will do a thread of me replaying all the games that I have developed so far and see if thay still work and if I can beat them in 2024!</p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1807668217734660294?ref_src=twsrc%5Etfw">July 1, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 
<p>I was overall very pleased to rediscover my old creations, most of them being playable in 2024 and offering a real experience to the player (that's the case of all the js13k entries made since 2015, but more particularly the ones made after I got into CSS3D and emoji).
<br>
<br>
<hr>
<br>
<p><b>August 2024</b>
<p>August has arrived, and there are another 13 days to wait until the start of the jam. How about working on tools that could become handy if I make an actual 3D WebGL entry this year? (after 7 years of making all my 3D games with CSS3D)
<p>The vague idea of an entry inspired by Mario 64 has been in my head for many years, and if I actually try to do it in this edition of JS13K, one thing I will need for sure is a tiny pixelized texture generator to represent surfaces like rock, grass, sand or water. LOSSST 2021 used <a href="https://codepen.io/collection/DRMKdB">Bence's amazing SVG textures</a>, but this time I want something much, much smaller, more generic, and pixel-y!
<p>And that's how I invented <a href="https://xem.github.io/pxtex/">ptex</a>: a 228 bytes long JS function that takes a HTML canvas, a HSL color, a noise coefficient and a size, and outputs some yummy randomized pixel-art textures ready to use as base64 pngs.
<br><br>
<p><img src=images/js13k24/4.png width=600>
<br><br>
<p>The tool is actually as simple as it sounds (it draws colored squares on a canvas), but was still very well received in the js13k community:
<p>- It was featured in GamedevJS's newsletter and on X:
<blockquote class="twitter-tweet" data-theme="dark" data-media-max-width="560"><p lang="en" dir="ltr">Just before the start of <a href="https://twitter.com/js13kGames?ref_src=twsrc%5Etfw">@js13kGames</a> tomorrow, long time participant and legendary creator of multiple useful mini tools, <a href="https://twitter.com/MaximeEuziere?ref_src=twsrc%5Etfw">@MaximeEuziere</a>, released another one: Pxtex – mini randomized pixel-art textures.<a href="https://t.co/6PKkqfZsyB">https://t.co/6PKkqfZsyB</a><a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://twitter.com/hashtag/gamedev?src=hash&amp;ref_src=twsrc%5Etfw">#gamedev</a> <a href="https://twitter.com/hashtag/gamedevjs?src=hash&amp;ref_src=twsrc%5Etfw">#gamedevjs</a> <a href="https://twitter.com/hashtag/JavaScript?src=hash&amp;ref_src=twsrc%5Etfw">#JavaScript</a> <a href="https://twitter.com/hashtag/codegolf?src=hash&amp;ref_src=twsrc%5Etfw">#codegolf</a></p>&mdash; Gamedev.js (@Gamedevjs) <a href="https://twitter.com/Gamedevjs/status/1822996864787947820?ref_src=twsrc%5Etfw">August 12, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 

<p>- And another dev, Lewis Nakao, made <a href="https://lewdev.github.io/apps/pxtex-tool/">a cool UI around it</a>:
<blockquote class="twitter-tweet" data-theme="dark" data-media-max-width="560"><p lang="en" dir="ltr">Just so I could play around with <a href="https://twitter.com/hashtag/pxtex?src=hash&amp;ref_src=twsrc%5Etfw">#pxtex</a> by <a href="https://twitter.com/MaximeEuziere?ref_src=twsrc%5Etfw">@MaximeEuziere</a>, I made a tool and figured it might be useful to others in the <a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a>. I had to figure out the &quot;max&quot; values for each parameter. The Hue value wraps at 360.<br><br>⛏️ <a href="https://t.co/PH0IJ7OgRN">https://t.co/PH0IJ7OgRN</a><br><br>Source Code: <a href="https://t.co/bNfMNPXFgJ">https://t.co/bNfMNPXFgJ</a> <a href="https://t.co/PpBB7np7Zz">pic.twitter.com/PpBB7np7Zz</a></p>&mdash; Lewis Nakao (@lewdev) <a href="https://twitter.com/lewdev/status/1825480343014854919?ref_src=twsrc%5Etfw">August 19, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>The second tool that I wanted to make was an absolute minimal WebGL boilerplate to display 3D shapes on screen.<p>I created <a href="https://xem.github.io/W/">W.js</a> in 2020 with the help of <b>@Stas</b> and <b>@Kchplr</b>, which was full of cool features and as small as possible (2kb zipped), but I wanted to see how low we could go by keeping only the bare essentials:
<p>- Render planes and cubes out-of-the-box
<br>- Render custom 3D models based on vertex / uv arrays
<br>- Coloring, texturing and support for transparency
<br>- Easily set camera and objects' position, rotation and scale.
<br>- Automatic shading from diffuse and ambient light
<p>The features left out are: billboards, animations, smooth shading, normal arrays, indexed models and groups.<p>They were amazing features of course, but took too much space.
<p>I first tried to start from W's source code and trim everything I didn't need, but the result remained too verbose. So I restarted from scratch, with a different model.
<p>Now, the scene (with its clear color, camera, light and 3D objects) is entirely defined in a JSON object.
<p>WebGL's z-index is not friends with transparency. W.js had a built-in function reordering every item on-the-fly, but here, to make things simpler, the objects with transparency just need to be declared in the correct order (from back to front) to be displayed properly.
<p>The library only contains a function called <b>W.render()</b>, which can easily be called once, or 60 times per second for a game loop, and the cube's 3D model. (the plane model comes for free, by ony rendering the front face of a cube). 
<p>Thanks to these extreme simplifications, I was very proud to see the result fit in 1kb zipped.
<p>I released it with 3 interactive demos and called it <a href="https://xem.github.io/microW/">MicroW</a>.
<br><br>
<p><img src=images/js13k24/5.jpg width=900>
<br><br>
<blockquote class="twitter-tweet" data-theme="dark" data-media-max-width="560"><p lang="en" dir="ltr">New mini gamedev resource for <a href="https://twitter.com/Gamedevjs?ref_src=twsrc%5Etfw">@gamedevjs</a> &amp; <a href="https://twitter.com/js13kGames?ref_src=twsrc%5Etfw">@js13kgames</a> 2024...<br>MicroW: a WebGL renderer in less than 1kb!<br>- Built-in shapes (cube, plane)<br>- Custom shapes<br>- Coloring, texturing, alpha-blending, lighting<br>- Free position, transformation for camera &amp; objects<a href="https://t.co/X422ZQrODB">https://t.co/X422ZQrODB</a> <a href="https://t.co/I7GE5ZOPsA">pic.twitter.com/I7GE5ZOPsA</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1823244897375187331?ref_src=twsrc%5Etfw">August 13, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 
<p>Some feedbacks on MicroW:
<p><b>@mcfunkypants</b>: "WOW!!! amazing work!"
<p><b>@joao</b>: "Awesome :) i used your W in my gamedevjs entry this year"
<p><b>@mvasilkov</b>: "Epic as always :) I pledged I'd learn WebGL for this year's compo but alas :("
<p><b>@FrankForce</b>: "amazing work! i will be using this for reference as i am planning to go 3d this year!"
<p><b>@soylentgraham</b> showed me an even more compact way to declare the vertex coordinates of my 3D models, using gl_vertexid (skipping attribute buffers entirely):
<pre class=language-js><code>// GLSL cube
vec3 GetLocalPosition(int v){
  int x = ivec4(915775499,923195439,642272978,49129)[v/30]>>v%30;
  return sign(vec3(x&1,x&2,x&4));
}</code></pre>
<p>Seems magic. I'll look into this!
<p>Another challenge I started at the end of July is implementing my own 3D physics engine in JS (because all the existing ones weigh more than 100kb). I've bought and read some <a href="https://www.amazon.com/s?k=physics+engine+game&crid=2629HQH2ISLU4&sprefix=physics+engine+game%2Caps%2C312&ref=nb_sb_noss_1">books</a> and <a href="https://gamephysicsweekend.github.io/">ebooks</a> related to this topic but didn't manage to get past collision detection yet. 
<p><a href="https://xem.github.io/GamePhysicsJS/">This project</a> shows how far I could get while waiting for js13k to start.
<p>It's incomplete, but I will try again later. In the meantime, I shared my favourite books with <b>@cody</b> who will try to use it for his own entry... good luck to him !
<br>
<br>
<hr>
<br>
<p>In early August, <b>@end3r</b> advertised js13kgames 2024 on Dwitter with <a href="https://www.dwitter.net/d/32204">a 140b countdown</a>.
<p>It gave me the idea to make a series of little Dweets to advertize the jam, too:
<p>- <a href="https://dwitter.net/d/32224">What are 13,312 bytes?</a>
<br>- <a href="https://dwitter.net/d/32232">Typical js13k project size</a>
<br>- <a href="https://dwitter.net/d/32234">JS13k logo</a> (using a Path2D) 
<br>- <a href="https://dwitter.net/d/32244">JS13k 2024 tshirt</a> (using a black t-shirt emoji and little red Unicode characters that look like gamepads)
<br><br>
<p><img src=images/js13k24/6.png width=900>
<br><br>

<p>While doing these, I also contributed to Dwitter with <a href="https://www.dwitter.net/d/32233">an easier-than-ever Dweet packer</a>: paste your code in the field (up to 194 ASCII chars) and it's instantly converted into a 140-chars snippet...
<br><br>
<p><img src=images/js13k24/7.png width=500>
<br><br>

<p>...and <a href="https://www.dwitter.net/d/32220">a dweet about olympic games</a> held in my country at that moment (I didn't have enough room to make the rings overlap correctly).
<br><br>
<p><img src=images/js13k24/12.png width=400>
<br>
<br>
<hr>
<br>
<p><h2 id=game1>DAYS 1-11: GREAT PLUMBER 65</h2>
<br>
<hr>
<br>
<p><b>DAY 1</b>
<p>It's finally August 13th! The theme is <b>Tristaidekaphobia</b> and... it gives me no ideas at all.
<p>I scribbled some vague ideas on my notepad such as "maths game", "fear game", "puzzle with 13 pieces", "puzzle where you're limited to 13 moves", "Apollo 13", "avoid number 13", "avoid good luck"...
<p>But nothing clicked so far.
<p>(At the end of the jam, I was pleased to see that other contestants had made very good games based on some of these ideas, and much better than I would have done myself.)
<br>
<p>I looked on <a href="https://wordsmith.org/anagram/index.html">Wordsmith.org</a> if there are good anagrams of the theme.
<p>Triskaidekaphobia contains the letters of interesting words such as <b>skateboard, skatepark, karate kid, bishop, parakite, parasitoid, idiopathies, apartheids, editorship</b> and <b>database</b>...
<p>It's hard to make a full sentence with these letters though.
<br>We can write weird things like:
<br>
<b>"I, bishop, karate kaid"
<br>"I'd hoist a bike parka"
<br>"A pariah debit kiosk"
<br>"It spied a khaki bro"</b>
<br>... or even...<br><b>"Bad skatepark, o hiii"</b>.
<p>None of these phrases really inspire me. The last one could maybe be a pretext to do a Line Rider clone... 
<p>While waiting for a better idea to come, I tried to make a quick prototype of 2D skate simulation based on my <a href="https://xem.github.io/mini2Dphysics/">Mini2DPhysics engine</a>, with the skate and the skater being two different entities, and found that it worked quite well! Who knows, it could become my plan B...
<br>
<br>
<video src=images/js13k24/1.mp4 controls width=600></video>
<br>
<hr>
<br>
<p><b>DAY 2</b>
<p>Hmm. Yeah, there's that skate idea, but it lacks some "Wow effect".
<p>I'd like to do something more impressive... such as the Mario 64 demake idea I've had for years...
<p>Then it hit me: Nintendo sometimes strikes the fan games that infringe their IPs. A deformed version of the theme could look like "Strika-Nintendoka-Phobia", which would be a made-up fear of being striked by Nintendo. Okay, let's do that!

<p>Let's make a pact with <s>the devil</s> <b>@end3r</b> to launch the project!
<br><br>
<p><img src=images/js13k24/1.png width=800>
<br>
<br>

<p>I'll show my progress on X and Slack, but I will hide all the Mario references, to avoid spoilers! (even the Mario 3D model present in Midi3Dplatformer got replaced by a brown parallelepiped).
<p>Ideally, I'd like to do a complete demake of Mario 64 in 5 chapters, five actual JS13K entries that would be able to share data and assets with each other, and I would call the game something like "GREAT PLUMBER 65", because 65kb = 5 x 13kb. Though, I know the task would be too immense for a single dev, with such size and time constraints, so I'll probably go with something much smaller, in a single entry, but as impressive as possible. <a href="https://www.youtube.com/clip/UgkxzZJ4oTvJFhEzQ4Z3Pc-4iT2owIfoEPGO">The intro and castle's outdoors</a> will certainly be enough.

<p>I started by unearthing and connecting together two of the tools I invented a few years ago:
<p>- <a href="https://xem.github.io/3Dmapeditor/">3Dmapeditor</a>
<br>- <a href="https://github.com/xem/mini3DPlatformer">Mini3DPlatformer</a>
<br><br>
<p><img src=images/js13k24/8.png width=900>
<br><br>
<p>Both tools weren't made to communicate with each other, and do not share any code whatsoever (the former is made in CSS3D and the latter in WebGL), but I made them communicate through a common ASCII export that represents the level. 3Dmapeditor outputs it, and Mini3Dplatformer parses it to construct its scene.
<p>To make this (rather unholy) communication work as I want, I first had to make Mini3DPlatformer able to display different kinds of cubes (grass, sand, rock, roof and water).
<p>Then, I added slope blocks in both tools:

<p>In 3Dmapeditor, the edits made to my generic 200*200*200px cube consisted of hiding the up face, slanting the front face, and clipping the left and right faces as triangles, with CSS:

<pre class=language-css><code>/* slope */
.s3 .up { display: none }
.s3 .front { height: 282px; transform: translate3D(0,-82px,0) rotateX(-45deg) }
.s3 .left { clip-path: path('M0 0L200 200L0 200Z') }
.s3 .right { clip-path: path('M200 0L200 200L0 200Z') }</code></pre>


<p>In Mini3DPlatformer, which is based on W.js, I added the slope 3D model manually:

<pre class=language-js><code>// SLOPE
//
//  /\
// |\ \
// | \ \
// |  \ \
// |___\/

W.add("slope", {
  vertices: [
    .5, .5,-.5,  -.5, .5,-.5,  -.5,-.5, .5, // front
    .5, .5,-.5,  -.5,-.5, .5,   .5,-.5, .5,
    .5, .5,-.5,   .5,-.5, .5,   .5,-.5,-.5, // right
   -.5,-.5,-.5,  -.5, -.5, .5, -.5, .5,-.5, // left
   -.5, .5,-.5,   .5, .5,-.5,   .5,-.5,-.5, // back
   -.5, .5,-.5,   .5,-.5,-.5,  -.5,-.5,-.5,
    .5,-.5, .5,  -.5,-.5, .5,  -.5,-.5,-.5, // down
    .5,-.5, .5,  -.5,-.5,-.5,   .5,-.5,-.5
  ],
  uv: [
    1, 1,   0, 1,   0, 0, // front
    1, 1,   0, 0,   1, 0,            
    1, 1,   0, 0,   0, 1, // right
    0, 1,   0, 0,   1, 1, // left
    1, 1,   0, 1,   0, 0, // back
    1, 1,   0, 0,   1, 0,
    1, 1,   0, 1,   0, 0, // down
    1, 1,   0, 0,   1, 0
  ]
});</code></pre>

<br><br>
<p><img src=images/js13k24/14.png width=900>
<br><br>

<p>I ended the day by making a little sample level containing pretty much all the items I'll need in my entry: ground (made of grass, sand and water blocks), obstacles (walls and slopes) made of rock, and a billboard tree.
<p>This area will be my 3D platforming playfield for a few days! 

<br><br>
<p><img src=images/js13k24/15.png width=700>
<br><br>

<blockquote class="twitter-tweet"  data-theme="dark" data-media-max-width="560" data-lang="en"><p lang="en" dir="ltr">So I&#39;m unearthing the 3D map editor (in CSS) &amp; the 3D platformer template (in WebGL) that I started making years ago, and trying to connect the two.<br><br>If I don&#39;t get stuck, I&#39;ll try to make a 3D platformer that could maybe fit the theme.<br><br>Otherwise... I&#39;ll need a plan B!<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://t.co/m2P16YR9UY">pic.twitter.com/m2P16YR9UY</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1823803231174349287?ref_src=twsrc%5Etfw">August 14, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 

<br>
<br>
<hr>
<br>
<p><b>DAY 3</b>

<p>After yesterday's quick prototyping, let's include the unminified version of W.js and the code of mini3Dplatformer with my little sample level into my index.html file. Bam! It's already 31kb.

<p>Here, my little PoC (Proof of Concept) is taking shape, with ground collisions, (buggy) wall collisions, plus some basic character movement and rotations.
<p>Contrary to Mario 64, I took the liberty to always have the camera behind the character, otherwise the code required to make pleasant and fluid controls would have been too complex to implement.

<p>By the way, I'll keep using W.js (instead of MicroW) in my code because this project requires groups, animations and billboards, which are only present in W.js.

<blockquote class="twitter-tweet" data-theme="dark"><p lang="en" dir="ltr">DAY 3<br>Added movement, rotation, cube collisions and billboards (the tree plane always facing the camera).<br>Since it&#39;s a PoC, my collision code is still hacky.<br>To makes the slopes work, I have to rewrite it in a more clean and generic way.<br>Hopefully it&#39;ll be done tomorrow!<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://t.co/mznhUdf5WA">pic.twitter.com/mznhUdf5WA</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1824125900096495742?ref_src=twsrc%5Etfw">August 15, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 

<p>In the meantime, I secretly worked on the title screen of my entry. I wanted it to look like Super Mario 64's title, but with a different name (Great Plumber 65). Instead of drawing it on a canvas or using SVG, I decided to use a Web font that I found online, specially created for this: <a href="https://www.fontspace.com/typeface-mario-64-font-f60208">Typeface Mario 64</a>.

<p>The font is in otf, weighs 10kb and contains way more characters than I actually need, so I searched (and found) a great software called <a href="https://fontforge.org/en-US/">FontForge</a>, which allowed me to edit the font, delete all the chars I didn't need and save it in woff2 format, reducing it to just 1.5kb!

<br><br>
<p><img src=images/js13k24/9.png width=700>
<br><br>

<p>With some HTML and CSS on top of this font (namely, custom colors, scale, letter-spacing, text-stroke and multiple text-shadows for the depth effect), I managed to make this (very convincing ?) title screen!

<p>(I realize a bit late that I could have added a bit of CSS3D to slant the text a little...)

<br><br>
<p><img src=images/js13k24/10.png width=900>
<br><br>

<p><a href="https://xem.github.io/js13k24/1-intro/">LIVE DEMO</a> <p>(click to start! As a bonus, you'll see a little entrance animation and hear a coin sound from <a href="https://xem.github.io/MiniSoundEditor/">MiniSoundEditor</a>).
<p>The whole intro weighs 2.4kb zipped.

<p>I tried <a href="https://xem.github.io/js13k24/2-intro/">another version</a>, spelling the word StrikaNintendokaPhobia, but it was not as good.

<br><br>
<p><img src=images/js13k24/11.png width=500>

<p>In a desperate hope to save a few hundred bytes in my zip, I suggested <b>@end3r</b> to do <a href="https://x.com/js13kGames/status/1823825897872613586">a poll about allowing to load Webfonts for free</a>, but it didn't convince enough people. So I'll keep my woff2 file on board!

<br><br>
<p><img src=images/js13k24/13.jpg width=500>
<br>

<p>I also made some quick tests of <a href="https://xem.github.io/miniSpeechRecognitionAndSynthesis/miniSpeechSynthesis/lang.html">speech synth</a> with a male and a female voice (before realizing how deep the rabbit hole of speech synth voices can be):

<br><video src=images/js13k24/2.mp4 controls width=300 height=200></video>
&nbsp; <video src=images/js13k24/3.mp4 controls width=300 height=200></video>

<br>
<br>
<hr>
<br>
<p><b>DAY 4</b>

<p>On day 4, I had so much progress to share that I made four X posts, instead of the usual 1 or 2.
<p>The first one shows how I added black debug spheres on every integer coordinate of the ground, and red ones at the corners of my hero. These spheres not only ensure that all the assets are well aligned with their coordinates (a 0.5 or 1 unit offset offset can easily go unnoticed!), they also surround the hero with an axis-aligned box (if you look closely, the red spheres never rotate with the hero, they stay aligned with the integer grid. This is the first step towards good collision detection.
<p>The second post shows a new set of (blue) debug spheres at the bottom of the hero. In fact, I implemented a "collision()" function that tells for any (x, z) coordinates, what's the height of the level geometry at these exact coordinates. The four blue spheres that follow the hero's bounding box, represent the result of this function. That's why you can see these spheres climb on slopes and cubes in the video (collisions were removed entirely at this moment).
  
<blockquote class="twitter-tweet" data-theme="dark"><p lang="en" dir="ltr">DAY 4<br>I added a blue set of debug spheres at the bottom corners of the AABB: at each frame, I place them at the height of the scenery block present at their coordinates (1 for cubes, 0 to 1 for slopes).<br>Now let&#39;s use that data to do the collisions and slopes work properly.<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://t.co/0SY7vs02ks">pic.twitter.com/0SY7vs02ks</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1824436056344731974?ref_src=twsrc%5Etfw">August 16, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 

<p>The "collision" function that computes the level's height at given coordinates was surprisingly <a href="https://github.com/xem/js13k24/blob/gh-pages/index.html#L1527-L1548">easy to implement</a> (it always returns 1 for cubes, and the decimal part of the X coordinate for a slope going to the east. the 3 other slopes directions are computed in a similar way, by using the decimal part of Z for a slope going to the south, and by substracting these values to 1 for the east and north slopes).

<p>The next step was to use the height of the blue spheres to interact with the environment:
<p>- hero.y represent the height of the hero's bottom (hero.y = 0 means that he's standing on the ground)
<br>- If a blue sphere has a height > hero.y + 0.2, a wall is hit. Stop moving.
<br>- If a blue sphere has a height between hero.y and hero.y + 0.2, we're at the beginning of a slope. Set hero.y to the height of the highest blue sphere.

<pre class=language-js><code>hero.y = Math.max(nw, ne, sw, se);</code></pre>

<p>I spent the rest of the day trying to make "sliding" wall collisions, because it feels weird to be completely stopped when we touch a wall in a platform game. It's much more pleasant to see the hero slide against it. To do so, I tried to apply an opposite force every time we try to walk against a wall. Unfortunately, it gets buggy every time we walk into a cube's corner. Both adjacent faces fail to properly reject the hero at the same time and he's able to walk inside the cube...

<blockquote class="twitter-tweet" data-theme="dark"><p lang="en" dir="ltr">DAY 4, part 4:<br>Sliding collisions against walls work almost fine, as well as going up and down slopes, and all it took was that small code on the left.<br>It&#39;s not perfect though (see at the end of the video, it still bugs a little from certain angles)<br>But enough for today!<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://t.co/7lEsbItZys">pic.twitter.com/7lEsbItZys</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1824510946284540193?ref_src=twsrc%5Etfw">August 16, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 


<hr>
<br>
<p><b>DAY 5</b>

<p>It took me many, many hours between days 4 and 5 to find the correct way to implement these (damned) sliding collisions, but I finally managed to do it. The good and probably unique way to do this properly and without bugs is this one:


<pre class=language-js><code>// At each frame
// (...)

// Save previous hero X and Z coordinates
lastx = hero.x;
lastz = hero.z;
        
// Go front / back
if(keys.u || keys.d){

  // Compute new deltaX and deltaZ based on hero's angle and walk speed
  dz = (-keys.u + keys.d) * Math.cos(-hero.rcamera*Math.PI/180) / 20;
  dx = (-keys.u + keys.d) * Math.sin(-hero.rcamera*Math.PI/180) / 20;
  
  // Add deltaX do hero.x
  hero.x += dx;
  
  // Check collisions all around the hero
  nw = (collision(hero.x-.15, hero.y, hero.z-.15));
  ne = (collision(hero.x+.15, hero.y, hero.z-.15));
  sw = (collision(hero.x-.15, hero.y, hero.z+.15));
  se = (collision(hero.x+.15, hero.y, hero.z+.15));
  
  // If one collision is with a wall ( > hero.y + 0.2 ) 
  if(
    nw > hero.y + .2 || ne > hero.y + .2 || sw > hero.y + .2 || se > hero.y + .2
  ){
  
    // Go back to the last non-colliding x position
    hero.x = lastx;
  }
  
  // Then do exactly the same with deltaZ and hero.z
  hero.z += dz;
  nw = (collision(hero.x-.15, hero.y, hero.z-.15));
  ne = (collision(hero.x+.15, hero.y, hero.z-.15));
  sw = (collision(hero.x-.15, hero.y, hero.z+.15));
  se = (collision(hero.x+.15, hero.y, hero.z+.15));
  if(
    nw > hero.y + .2 || ne > hero.y + .2 || sw > hero.y + .2 || se > hero.y + .2
  ){
    hero.z = lastz;
  } 
}

// (...)</code></pre>

<p>This problem being out of the way, I could finally start working on my textures!


<p>I generated four 20x20px textures with pxtex and put them in &lt;img> elements at the end of my html page, as well as a &lt;svg> element containing a tree emoji 🌳. It was super easy to tell W.js use these 5 textures in my scene instead of flat colors.
<p>I also had the idea to make the grass, sand and water blocks have slightly different heights, to make the ground look less flat. Since their hit boxes aren't modified, it will even give the impression that the hero's feet go deeper in the grass than they do in the sand.

<br><br>
<p><img src=images/js13k24/18.jpg width=900>
<br>
<br>

<p>(As you can see, I tried different textures for the water until I found the one that I liked)

<blockquote class="twitter-tweet" data-theme="dark"><p lang="en" dir="ltr">DAY 5, part 2:<br>Micro texturing time!<br>- Removed the debug spheres.<br>- Stylized my grass/sand/rock pieces with different heights and four 20*20px textures generated with pxtex (featured in GameDevJS newsletter!).<br>- Used &lt;svg&gt;&lt;text&gt;🌳&lt;/text&gt;&lt;/svg&gt; in an img as my tree texture.<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://t.co/UuhvNB1UQh">pic.twitter.com/UuhvNB1UQh</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1824813534305255543?ref_src=twsrc%5Etfw">August 17, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 

<p>I spent the rest of the day making a different level, with more "layers" of cubes, more slopes, and red pyramids (to represent the castle's roofs). By chance, pyramids already existed in 3Dmapeditor and W.js.
<p>To make things simpler, these pyramids don't have collision boxes at all. You can walk through them.

<p>I also made the jumps smoother and added a basic swimming state (the hero's height gets a bit lower when its four blue hit spheres touch water).
 
<p>In the end, the thing that took most of my time that day was the tree. I've been doing js13k entries with emoji since 2017, and every time they cause problems. The main problem being that they don't appear with the same graphics on every OS and browser. Some OS will only show them in black and white, or not at all. Worse even, depending on the OS and browser used, they will have different horizontal and vertical offsets. The same tree could be fine on Windows, buried in the ground on Mac or flying in the air on Android. 

<p>The solution I found in 2018 was to convince <b>@end3r</b> to allow emoji webfonts polyfills for free in the jam's rules. Ever since, I've released many projects aiming to democratize uniformized emoji for js13k entries, the latest being soberly named <a href="https://github.com/xem/unicode13">unicode13</a> (the polyfill itself can be found in the <a href="https://xem.github.io/unicode13/emoji.html">unicode13/emoji</a> page).

<p>So, I loaded this polyfill in my game and wanted to use it for the tree texture. I couldn't make it work while the tree texture was a svg, so I reused pxtex's canvas to draw a big emoji tree with the right font, on a transparent background, export this canvas as a png image, and use this image as a WebGL texture. That's the tree you can see in the video below.

<blockquote class="twitter-tweet" data-conversation="none" data-theme="dark"><p lang="en" dir="ltr">DAY 5, part 3:<br>- Changed the map<br>- Added pyramids and a roof texture<br>- Added swimming<br>- Replaced svg emoji textures with emoji rendered on a canvas with the Twemoji webfont (for cross-browser consistency)<br>- Trees are bigger<br>- Your feet get lower than the grass surface<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://t.co/ooXSSIuUtd">pic.twitter.com/ooXSSIuUtd</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1824898584585674855?ref_src=twsrc%5Etfw">August 17, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 

<p>Here's my texture atlas so far: five 20x20 pxtex images, and one 200x200px tree emoji. Thanks to them, the scene will look the same for everyone! (the tree doesn't touch the bottom of the image to compensate the grass's extra height.)

<br><br>
<p><img src=images/js13k24/19.png width=500>
<br>
<br>

<hr>
<br>
<p><b>DAY 6</b>

<p>Here's the last public update made on X about this entry: it contains a new map with more trees, doors, fences and a flag.


<blockquote class="twitter-tweet" data-conversation="none" data-theme="dark"><p lang="en" dir="ltr">DAY 6:<br>- Added new elements (fence, flag, doors)<br>- Made trees and hero bigger, compared to the scene<br>- When swimming, movement speed and jump height are lower.<br>- On land, it&#39;s possible to double-jump (the second jump is a bit higher).<br>No more spoilers until release! 👋<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://t.co/ZkYrKsIJC7">pic.twitter.com/ZkYrKsIJC7</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1825159386722914310?ref_src=twsrc%5Etfw">August 18, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 


<p>The doors and flag are generated from the emoji webfont. The fence is drawn on a canvas with "fillrect()" (and enhanced with a horizontal gradient a bit later).
<p>Fences and doors are fixed planes, contrary to the trees and flags that are billboards (always facing the camera).
<p>The left door is the same as the right one, but flipped horizontally. The left door is aligned on the right and the right door to the left, so they can easily be applied as textures over two neighbour blocks.
<p>I also added hitboxes to the fences, but here too, it's very basic. The collision function says that their height is 1 if the decimal part of the Z coordinate is over 0.8, and 0 otherwise.
<p>You can see in the video that the fences don't have back faces: they become invisible when you walk behind them. To fix that, I had to use two planes, one for the front, and one for the back (rotated 180 degrees).

<p>A weird Webkit bug occurred while setting ids for my fence texture image:

<p>HTML: 
<pre class=language-html><code>&lt;img src="..." id=fence></code></pre>

<p>JS:
<pre class=language-js><code>console.log(fence) // null

console.log(window.fence) // null

fence = "test";

console.log(fence) // null</code></pre>

<p>Yup. "fence" is somehow a reserved word in Webkit browsers, you can't use it as a variable. It's always null. It took a lot of head-scratching before figuring this out (I thought the problem came from my texture), but when I finally realized what it really was, I just renamed my fence as "fenc". Suddenly, everything worked fine.

<p>This is the texture atlas at the end of day 6:
<br><br>
<p><img src=images/js13k24/20.png width=800>
<br>

<hr>
<br>
<p><b>DAYS 7 to 11</b>

<p>The last 5 days of development were not shared publicly. I'm gonna tell you here what happened during that period. I worked on a bunch of things simultaneously, so I'll present them to you in 10 chapters...
</p>
<br>
<hr>
<br><b>1) Speech synth</b>: while I was working on the title screen, I made a few tests of Speech Synth, and started explaining that it was a deep rabbit hole. It became even deeper when I started working on the second screen, where the princess reads the letter. The thing you need to know about the JS Speech Synth API is that the browsers barely have control on it. The only thing browsers do is request the OS to read a given text using a given voice. Many problems can occur at this point:
<br>- Warm-up delay: some browsers (especially Firefox and Android's mobile browsers) can't request the OS's list of voices and return them instantly. <pre class=inline><code class="lang-js">speechSynthesis.getVoices()</code></pre> will return an empty array on the first call, and an actual list if it's called again a few seconds later.
</p>
<br><img src=images/js13k24/21.png width=800>
<br>

<br>- The list of available voices is pretty much unpredictable, as it depends entirely on the OS. The list returned by the API includes names and language codes, but there's no way to know if a voice is male or female. I can only try to predict if a voice is male or female based on its name.
<br>So I asked on js13k's slack for volunteers to execute this line of JavaScript on their setup and show me the results:<br><br><pre class=inline><code class="lang-js">speechSynthesis.getVoices().filter(a=>a.lang.startsWith("en"))</code></pre>.<br><br>I received <a href="images/js13k24/22.png">enough samples</a> to create a list of 21 female and 16 male english voices, which I put in two regexes.

<pre class=language-js><code>// Known male/memale speech synth voices (thanks to people on Slack for giving me their)
female = /Female|Google US English|Susan|Hazel|Zira|Shelley|Grandma|Sandy|Martha|Aria|Priya|Heather|Hayley|Samantha|Catherine|Karen|Tessa|Moira|Kathy|Rishi|Libby/;
male = /Male|George|Rocko|Daniel|Grandpa|Eddy|Reed|Fred|Ralph|Mark|David|Arthur|Guy|Aaron|Albert|Jester/;</code></pre>

<br>When I have a text ro read with a male voice (ex: "It's a me, the great plumber"), I check if any of the available voice matches the male regex. If one does, use it. Else, use the first english voice available by default (even if it's female). The same thing goes for when I need a female voice (ex: "Dear plumber, please come to the castle...") and the female regex.


<br><br><hr><br><p><b>2) The princess' letter</b>: Between the title screen and the introduction, I wanted to reproduce the scene from Mario 64 where princess Peach reads a letter to Mario. I decided to reproduce this scene with HTML, emoji and CSS.

<br><br>
<br><img src=images/js13k24/23.png width=800>
<br>
<br>

<p>The thing is, there's no emoji that represents a side view of a princess. My friend <b>@KorHosik</b> and I looked through all the emoji available, and found the crown emoji (already used in my 2023 entry) and an emoji representing a blonde woman, looking down, in side view, holding/feeding a baby. After some resizing, positioning, rotation and cropping, I think I managed to do something quite resembling!

<br><br>
<br><img src=images/js13k24/24.png width=400>
<br>
<br>

<p>Another thing I needed to do well was the letter's font. There's no system font using pixel-art and I don't want to draw one by hand. Thankfully, the game's font <a href="https://fontmeme.com/fonts/mario-64-font/">is also available in ttf format</a> (and weighs 15kb).

<p>After a bit of trimming with FontForge (and editing the lowercase L that was strangely too much on the left - so much that "click to start" written in this font really looked like "dick to start" - by chance FontForge includes a very nice glyph editor too), I could export a 2.1kb woff2 file containing all the letters I needed for my game.

<br><br>
<br><img src=images/js13k24/25.png width=700>
<br>
<br>

<p>The rest of the letter is basic HTML and CSS. 

<br><br><hr><br><p><b>3) The final map</b>

<p>When I considered my platformer engine good enough, it was finally time to create the actual princess castle...
<p>I started by making sketches on paper, with the help of the amazing <a href="https://noclip.website/#sm64ds/1;ShareData=AMXG/Uke5VTCFLg8GuueV~q[B5eMsKT{?T5UrC4SWsyyxTQs@m92$TbT*67UWPA">noclip.website visualizer</a>, to determine the size of my map, which was initially 28x25 blocks, then reduced to 25x20, when seen from above. 

<br><br>
<br><img src=images/js13k24/26.png width=900>
<br>
<br>

<p>Of course, it's a demake, so a lot of details will be omitted to make it fit in 13kb, and everything will look more flat and cubic than in the original, however I already knew that it could look good because I had already made a (much smaller) 1kb Peach Castle demo for js1k 2019:
<br><br>
<br><img src=images/js1k19/peach1k.gif width=400>
<br>
<br>

<p>Then, I drew my castle with 3Dmapeditor, layer by layer, by leaving every invisible block (inside the castle and below the ground) empty to save space and improve rendering performances. It took me half a day, and initially took 21 layers. (Later, after realizing that my slopes collision detection didn't work well on heights higher than 1, I edited it down to 18 layers, reducing the ground's height to a single layer, at water level.

<p>I was surprised to see 3Dmapeditor, made in CSS3D, support very well the creation of such a big map. Below are some work-in-progress screenshots. You can remark that I added basic window 🪟, fence 🚧 and princess 👸 emoji in the editor and that the roofs are in "ice" color instead of red. The roof pyramids are also shown as one little block, but in the final entry, they will be scaled up to cover a larger area (like I had done in JS1K, by the way).

<br><br>
<br><img src=images/js13k24/27.png width=900>
<br>
<br>

<p>After copying the editor's ASCII output into my index.html, feeding it to my 3D platformer's renderer and making dozens of little adjustments manually, it was indeed much more pleasant to look at!

<br><br>
<br><img src=images/js13k24/28.jpg width=500>
<br>
<br>

Oops, that's an off-by-one error. Here it is:

<br><br>
<br><img src=images/js13k24/29.jpg width=900>
<br>
<br>

Ah, that's a good first draft. Take a look at the water pool blending with the background sea, compared to the original on N64:

<br><br>
<br><img src=images/js13k24/30.jpg width=900>
<br>
<br>

<p>I iterated on the castle's map, textures and overall rendering for 5 days to reach the version that you can see in the final release.

<p>After showing the first draft (using W.js's directional light) to my friend <b>Julien</b>, he suggested that I improve the light, because everything looked too flat.

<p>So I reopened <a href="https://xem.github.io/articles/webgl-guide.html">my WebGL tutorial</a> from 2020 and used it to replace W's directional with a point light, placed in the sky, near the entrance of the castle. I also added a little offset to the 3 roofs of the castle, to have them stand out a little from the walls below them.

<br><br>
<br><img src=images/js13k24/41.png width=800>
<br>
<br>

<p>It's a few small changes overall, but I believe it makes the scene look much, much better, so thanks for the idea!

<br><br><hr><br><p><b>4) The performance issues</b>

<p>The castle's map contained more than 1200 blocks in the first version, and 1003 after removing a few layers. Each block represents either a cube, a slope, a plane or a billboard, with textures and transparency (for the planes and billboards). W.js had never been tested with such a charge, and performance was crawling, even on my high-end PC.
<p>But I've never optimized a game! How do we do that? where should I start? 
<p>Oh, I know, sorting things is expensive. I remembered that W.js reorders all textured objects from back to front before drawing the scene (because WebGL needs that to handle transparency). But in my scene, everything is textured, and it's ridiculous to reorder 1003 elements 60 times per second!
<p>So I plunged into W's source code and created a "transparent" array containing only the planes and billboards of my scene. Suddenly, the sorting was done on 49 items instead of 1003 (yeah, the trees, doors, windows, flags and double-sided fences represent 49 elements).
<p>The second improvement I could think of was to perform the sorting once per second (i.e. once every 60 frames) instead of doing it at each frame, which is largely enough, as the transparent elements order doesn't change very quickly when we walk through the map.

<p>After that, the game became fluid on my PC, but also on my phone, so I didn't bother looking further.
<p>I know that a huge improvement could have been to do some sort of batch rendering instead of doing 1003 draw calls at each frame, but unfortunately, I haven't learned how to do that yet and didn't want to lose time learning that during the jam, so I stopped there for the optimizations!

<p>Note: it's still possible to see the effect of this 60-frame refresh time when you go between two trees and rotate the camera quickly: the "far" one will overlap the "close" one for a few frames.

<br><br>
<br><img src=images/js13k24/38.gif width=600>
<br>
<br>

<br><br><hr><br><p><b>5) Background and extra textures</b>
<p>While experimenting with my 3D platformer engine, I got bored with my blue uniform background color, so I wondered if it would be difficult to do some kind of skybox, or skysphere, like the ones present in Mario 64.

<p>I set my texture canvas size to 512 x 512 px, filled the bottom half with the same pxtex formula used for the water (most of the entry's loading time is spent generating it, by the way), and the top half with a blue gradient with some cloud emoji.

<br><br>
<br><img src=images/js13k24/31.png width=800>
<br>
<br>

<p>I tried applying this texture to a big sphere, 5 times bigger than the level, but there was a problem called backface culling! In other words, the sphere is made of triangles whose normals point to the exterior, making the exterior of the sphere textured and the interior transparent (similarly to fences planes only visible from one side).

<p>And how do we invert the normal of a triangle? Easy (when we know it): declare the triangle's vertices in reverse order. If the triangle ABC points to the exterior, then the triangle ACB points to the interior.

<br><br>
<br><img src=images/js13k24/32.png width=600>
<br>
<br>

<p>So, I edited the W.js function that generates spheres to make it output the vertices coordinates in reverse order, and it worked like a charm on the first try! (NB: this function is not written by me, I understand very little of how it works).
<p>To make the sphere look good visually in real conditions, I had to adjust some cloud positions, as close to the horizon as possible, so they don't get cut because of a triangle edge, or distorted because of their closeness to the sphere's north pole.

<br><br>
<br><img src=images/js13k24/33.png width=800>
<br>
<br>

<p>Fun fact: during development, I couldn't understand why the cloud emoji were cut when they were placed too close to the edge of a triangle, but I realize it now while writing these lines: I reversed the triangles vertices coordinates, but forgot to reverse the uv (texture) coordinates. This means that every triangle of my sky sphere has its texture flipped horizontally! Fortunately, with every cloud carefully positioned, this has no incidence on the final result.

<p>Other fun fact: I had to make the sky sphere immune to the scene's point light, otherwise it would have been weirdly shaded. Thankfully, W.js got me covered, as it supported a "ns" (no shading) property, that I used on the sky sphere to avoid this:


<br><br>
<br><img src=images/js13k24/42.png width=800>
<br>
<br>

<p>The other items that were made immune to shadting are the trees, because I didn't want them to become randomly lighter or darker when ther rotate to face the camera. 

<p>The castle's walls still looked too monotonous for me. On N64, the bricks are visible.
<p>After many attempts, my solution was to make the brick's pxtex texture 40 x 40px, and trace light gray lines over it with a repeating pattern:

<br><br>
<br><img src=images/js13k24/35.png width=800>
<br>
<br>

<p>For the princess mosaic, once again, I was ready to put a basic princess emoji there, but my friend <b>@KorHosik</b> was here to motivate me to do something better.
<p>So I combined a crown 👑, a kneeling woman 🧎‍♀️ and a flower emojis 💐, and with the correct position, rotation, scale and cropping, plus a golden ellipse and a blue background, it made a mosaic pattern that I enjoy a lot!
<p>(I don't know why I made an ellipse instead of this pointy shape... I guess in my memories it was an ellipse and I forgot to double-check when I coded it!)

<br><br>
<br><img src=images/js13k24/36.png width=800>
<br>
<br>

<p>I created a gradient texture very close to the one used for the fence, to apply on the wooden bridge:


<br><br>
<br><img src=images/js13k24/37.png width=800>
<br>
<br>

<p>On the last day of the project, I had a few dozen free bytes and decided to use them to represent the closed cannon near the lake, with a custom texture (it kinda looks 3D but it's just made of a circle and a few lines)

<br><br>
<br><img src=images/js13k24/38.png width=800>
<br>
<br>

<p>Last but not least (it's actually my favourite one!), I browsed the emoji list one more time to look for an emoji that could resemble Mario 64's windows a little, and stumbled upon... the pie emoji! 🥧

<p>With the Twemoji Webfont polyfill, it can totally pass as a window, so I decided to use it with a bit of rotation and scaling, and a lot of amusement! There are pies on walls in my js13k entry and no one will remark it unless I tell them, haha!


<br><br>
<br><img src=images/js13k24/39.png width=800>
<br>
<br>

<p>Here's the full texture atlas at the end of the development:
<p>You can remark that there are two wall textures (I kept one without bricks to put around the mosaic), and that the roof texture is bigger than the others (because the roof pyramids are scaled up).

<br><br>
<br><img src=images/js13k24/34.png width=900>
<br>
<br>



<br><br><hr><br><p><b>6) The intro sequence</b>

<p>In my 3D platformer engine, the camera is placed in the same group as the hero, to follow him "for free". 
<p>But if I want to make an intro sequence that looks like <a href="https://noclip.website/#sm64ds/1;ShareData=AMXG/Uke5VTCFLg8GuueV~q[B5eMsKT{?T5UrC4SWsyyxTQs@m92$TbT*67UWPA">the original</a>, I must move the camera freely from the sky, to the ground, up to the hero's spawning point.
<p>And, as you may know, in gamedev, <a href="https://www.gamedeveloper.com/programming/dirty-coding-tricks">dirty coding tricks</a> are often the best solutions for a problem, so instead of finding a way to detach the camera from the hero's group until the end of the cutscene, I simply moved the hero's group around the map, just to have the camera follow it, and the hero's geometry was simply moved 10 units downwards on the Y axis to stay off-screen.
<p>W.js already has an animation feature allowing to move/rotate an item from a position to another. I "only" had to find a way to chain animations in a fluid way to make the camera move between 12 different positions without any glitch (such as frame drops or animation overlaps). The implementation I ended up doing was rather elegant, where the animation code itself determines when the animation is complete and triggers the next one instantly.
<p>It was also quite easy to make the 3D platform engine start at the end of the sequence (it would have been weird if the gravity, collisions and keyboard controls worked during the intro). The whole platformer engine code is simply placed in the 12th and final step of the intro, just when the hero appears on screen and the green pipe disappears. You can see the engine kick in when the hero falls on the ground.

<pre class=language-js><code>// Intro animation
introstep = -1;

// intro() is called by W.js at the end of the animation routine, while introstep is &lt; 12 
intro = () => {

  introstep++;

  if(introstep === 0){

    // Hide princess letter
    princess.style.opacity = letter.style.opacity = 0;
    
    // Move hero/camera at the top of the castle (hero is hidden)
    hero.y = 12;
    hero.z = -.5;
    hero.x = 10;
    W.move({n: "H", x: hero.x, y: hero.y, z: hero.z, a: 5000}) // move hero group for 5 seconds
  }
  else if(introstep === 1){
    // ...
  }

  else if(introstep === 2){
    //...
  }

  // etc...
  
  else if(introstep === 12){
  
    // Hide pipe
    W.move({n: "pipe", y: -100, size: .01, a: 1});

    // End of intro, start game loop
    setInterval(()=>{
      
      // entire game engine here...
      
    }, 16);
  }
}</code></pre>
<p>At first I wasn't motivated to make the green pipe thing (I just wanted to make the hero fall from the sky), but my friends <b>@KorHosik</b> and <b>Mia</b> convinced me to do it and I must admit that it's much better like that... (It's just two green cubes, though, not what I'd call a lot of work).
<p>One thing I voluntatily didn't include in my intro is the Lakitu (the little guy flying on a cloud with a camera).
<p>When I made the intro's music afterwards, I adjusted the intro's timing so that it synchronizes perfectly with the duration of the melody.

<p>At the end of the intro, mobile controls appear on mobiles and tablets. Making the buttons was not difficult, but detecting mobiles and tablets has become difficult in 2024, since Android browsers stopped including "Android" or "Mobile" in their user-agents.

<br><br>
<br><img src=images/js13k24/40.png width=700>
<br>
<br>

<p>I searched for a reliable way to detect handheld devices, but didn't find a lot of solutions (most of the StackOverflow answers still rely on user-agent). I ended up finding a window property that seems to be undefined on most desktops and an integer >= 0 on most mobiles and tablets: <b>window.orientation</b>, so I used that. I guess it works fine, as no one has complained since.

<br><br><hr><br><p><b>7) The hero</b>
<p>It was finally time to replace my brown elongated cube with a real character that looks like Mario. I coded it from top to bottom, with a bunch of cubes: 3 for the hat and head, 3 for the body and arms, 4 for the legs and shoes, colored with flat colors. I didn't bother modeling or texturing the hero's face as it's almost never visible.

<p>When the hero moves to the front or the back, a walk frame counter is incremented, and the arms and legs receive an angle proportional to the cosine of this counter, making them swing from front to back and giving a good illusion of walk animation.

<p><b>KorHosik</b> suggested that an arm of the hero should stay in the air when he jumps. I guess it's a reference to <s>Hitler</s> the jump sprite in Super Mario Bros. Anyway, I implemented it.

<p>When the hero jumps three times consecutively in a short period, I implemented a triple-jump system similar to <a href="https://youtu.be/FR6PG-MAV3M?t=3">the one in Mario 64</a>: the second jump is a bit higher and the third one is even higher and adds a "roulade" in the air. It's the kind of small additions that add very few bytes and act as a fun easter-egg for people who discover it.

<p>I also added colisions to the trees because it was weird to see the hero walking through them. However, to keep things simple, they have the same hitbox than a cube.

<p>Finally, there's the question of water. I already implemented a basic "swim" position in my platformer prototype, but I enhanced it a little here, by adding an animation between the "standing up" and "swimming" positions. I also made the movement in water slower than on land, and the jumps from water reach a lower height. 

<p>I showed the result to <b>@end3r</b>, and he didn't judged that my work deserved a strike... I don't know how I should take it, haha! (For his defense, the castle's lacked its final mosaic and a few windows when I show it to him. It's probably more realistic now!)

<br><br>
<br><img src=images/js13k24/2.png width=700>
<br>
<br>

<br><br><hr><br><p><b>8) Inside the castle</b>
<p>My entry needed some sort of ending, besides wandering around the castle. I first imagined modeling the interior of the castle with my map editor, but it would have taken a lot of time and a lot of bytes, for virtually no advantage (even if the castle's interior existed, it wouldn't have lead to any rooms or stages from Mario 64, it would just have been an empty room).
<p>So I decided to do something simpler: I remembered that we talk to a Toad when we enter the castle in Mario 64, so I made a fixed screen containing a talking mushroom. It is composited in HTML using mushroom 🍄, mouth 👅 and eyes 👀 emojis.
<p>I made it read a letter with a high-pitch female voice and a fast voice. Overall, a lot of the code from the princess' letter could be reused there. This letter was a good way to mention that the mushroom is a NPC (one of the decentralized challenges was to use NPCs) and to mention the strika-nintendoka-phobia (which is the only link between my entry and the theme of the jam!).

<br><br>
<br><img src=images/js13k24/43.png width=900>
<br>
<br>

<p>So yeah, it could have looked much better, but I chose to end up like that and use the remaining time to go work on other entries.

<br><br><hr><br><p><b>9) The audio</b>
<p>The audio part takes an important place in this entry:
<p>- Speech synth was used for the title screen, the princess' letter and the mushroom's dialogue, but also for the plumber's triple jumps. Most of the players found these little "woo", "hoohoo" and "yahoo" voice clips funny, so I'm glad I kept them in.
<p>- Both music tracks (the one you can hear during the intro, and the one you can hear after the mushroom's speech) were made from a list of notes extracted from <a href="https://www.khinsider.com/midi/n64/super-mario-64">Mario 64 MIDI files that I found online</a>, using my <a href="https://xem.github.io/midi2array/">midi2array</a> tool. The first song has two instruments playing together, and the second, just one. The final song was 45 seconds long at the beginning, but I extended it to 1min35 before release because I had enough room to include the extra notes. The tracks are played using <a href="https://xem.github.io/js1k19/miniSynth/index.html">my mini piano synth</a>.
<p>- Finally, the sound effects. There are 7 of them: the coin sound (for the title screen), the wobwobby sound (for the pipe animation), the step soud (when the hero walks), the splash sound (when he enters water), the mini splash (when he swims), the water jump sound (when he jumps out of water) and the door opening sound (when he enters the castle). All of them come from my beloved tool <a href="https://xem.github.io/MiniSoundEditor/">MiniSoundEditor</a>, created by <b>Anders Kaare</b> in 2016 and maintained by me since then.


<br><br><hr><br><p><b>10) Golfing and release</b>

<p>Keep in mind that besides prototypes, all my entry has been developed in a single index.html file. It is 2263 lines long. 636 lines are used by W.js and its shapes, 415 lines by the ASCII map, 223 lines by the 3D platformer engine and 170 lines by music, sounds and voices. All the rest was coded by me during the jam.

<p>This year, I got no trouble navigating and editing this long file for 10 days. The same thing actually happened with my two other entries. After 10 years of competing with a ton of JS and CSS files, 2024 seems to be the year of the monolith.

<p>Anyways, I knew the weight of my custom fonts (3.6kb) and I knew that W.js was about 2kb zipped. I didn't really keep track of my project size until the last day of development, imagining that there would always be enough time to golf and apply extreme compression tricks afterwards if needed. As a result, index.html is 71kb, and when I minified and zipped it for the first time on day 10, the index.html got reduced to 31kb, and the zip file reached 13,654b (13.3kb).

<p>I thought I would have to golf my code a little (at least rename some variables names to 1 char), but I remembered that multi-file zips were optimizable with <a href="https://github.com/fhanau/Efficient-Compression-Tool">ECT</a>, and when I used it, my zip containing the minified index.html and two woff2 fonts suddenly dropped to 13,302b (12.9kb).

<blockquote class="twitter-tweet" data-theme="dark"><p lang="en" dir="ltr">DAY 10 (update):<br>I forgot to run ECT on my zip. I won&#39;t need to golf it finally. It&#39;s already 10 bytes under the 13kb budget with a simple command line.<br>Also, it doesn&#39;t use Roadroller because it needs to do stuff as soon as the page opens, and other things after onload.<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://t.co/0bj54COoLv">pic.twitter.com/0bj54COoLv</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1826521112882098280?ref_src=twsrc%5Etfw">August 22, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 


<p>I actually ended up renaming a few variables to have enough room for tiny improvements here and there (the pipe, the cannon, the grid texture and the extended final music), but nothing very complex.

<p>One thing I did not use for once was <a href="https://github.com/lifthrasiir/roadroller">RoadRoller</a>. As I explained on X, my entry had to execute some JS code instantly when the page loads (preheat the Speech synth, preload the fonts, display the pre-title "loading" screen), and the rest of the code after the fonts were entirely loaded.

<p>For the record, I forced the loading of the title font "m" and the twemoji webfont "emoji" by using them at the end of the "loading..." message (just hidden from plain sight, but here anyway):

<pre class=language-html><code>&lt;h2 id=load>loading...&lt;span style='font:1px emoji;opacity:0'>🌳&lt;/span>&lt;span style='font:1px m;opacity:0'>G&lt;/h2></code></pre>

<p>Thanks to these two spans at the end of my loading title, the window.onload event didn't trigger until all the fonts were entirely loaded!

<p>If I had really wanted to incorporate more content into my game, such as other areas to explore, it would have been quite easy to save at least two kilobytes. RoadRoaller would have been useable if I had tweaked my code a little to make it work with it, but most importantly, the two woff2 custom fonts could have been removed entirely: the title screen would have easily been drawable as a single svg file, and the alphabet pixel font, used for all the other text present in the game, could have been reproduced with some basic JS code (each character being represented by a grid of 5x7 monochrome pixels, easily encodable on 5 ASCII chars).

<p>But on day 10, I had to make a choice: continue to compress and improve / augment my game until the end of the jam, or make another entry?

<p>I chose to stop there, <a href="https://github.com/xem/js13k24/blob/gh-pages/index.html"><b>comment my code</b></a> to help curious visitors understand how it was done, and then make another entry... because whatever I could have done in it for the remaining 20 days, my GREAT PLUMBER 65 entry would have remained a tech demo, only a slightly more impressive one. But if I made another entry, then it would be an opportunity to make a real and original game. And that's what I decided.

<p>I released GREAT PLUMBER 65 right when the submit form opened, making it the very first and most visible entry in the list! I felt a bit lonely at first, but other entries quickly joined me in the games list.

<br><br>
<br><img src=images/js13k24/44.png width=800>
<br>
<br>

<blockquote class="twitter-tweet" data-conversation="none" data-theme="dark"><p lang="en" dir="ltr">DAY 11:<br>After adding a few details, longer musics, commenting my code and golfing/optimizing my zip, I&#39;m once again a few bytes below budget and ready to release my &quot;tech demo&quot; entry!<br>Does someone recognize this hint?<br>I&#39;ll spend the next 20 days on my second game! :3<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://t.co/distwibG4s">pic.twitter.com/distwibG4s</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1826939106426851411?ref_src=twsrc%5Etfw">August 23, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 


<br>
<br>
<hr>
<br>
<p><h2 id=game2>DAYS 12-21: EMOJIPHOBIA</h2>

<br><hr><br>

<p><b>Brainstorming</b>

<p>On day 12, I asked my friend <b>@KorHosik</b> if he had an idea for my next game. Something with actual gameplay and a strong link with the theme. We brainstormed for a bit about a game where we would hold some kind of shop where people could come and buy things that scare them. For example, someone enters and asks for a cynophobia, and if we give them a dog, it scares them and we score points.
<p>I said I'll try to do something like that, and started by imagining how phobias could be represented in such a game. Naturally, the answer that came to me was EMOJI.

<br><br><hr><br>

<p><b>Listing</b>

<p>I spent about 5 days (on and off), constituting <a href="https://github.com/xem/js13k24-phobia/blob/f4f2fe14b855a6770cc136a65259d875d88708fb/index.html#L53">a list of 700+ real phobias</a> from different online sources.
<p>For each phobia of the list, I had the name, the definition, and little by little, I took the time to manually add an emoji for every phobia that could be represented by an emoji.
<p>You may have heard of the wiki of phobias <a href="https://phobia.fandom.com/wiki/Phobia_wiki">Phobiapedia</a>, containing more than 5300 articles. This website is NOT a reliable source of information, as it allows real and made-up phobias. My list was only comprised of phobias found in at least 2 other sources than this wiki, to ensure that they are legit.

<br><br><hr><br>

<p><b>Emojification</b>

<p>After adding an emoji everywhere I could, I remarked a few things:
<ul><li>There are a lot of duplicates. More precisely, a single phobia could have 2, 3, 4 or more different names. For example: "Cryophobia, Frigophobia, Cheimaphobia, Psychrophobia: fear of cold".
<li>I was sad to see that many emoji from <a href="https://xem.github.io/unicode13/emoji.html">my emoji list</a> didn't appear on my list. So I took the most interesting ones, and googled them one by one: "Fear of ears", "fear of suitcases", etc. Most of them actually existed! This process allowed me to add an extra 44 elements to my list, mostly phobias specific to some animals (there's almost no animals that no one fears), but a few interesting others too. It also allowed me to create a separate list of phobias that DO NOT exist, that could be used in the game too. (For these made-up phobias, I invented the name myself based on the latin translation of the emoji name).
<li>Fears of colors are a thing that exists. I listed 11 of them, and since only 9 had a corresponding emoji (🔴⚪⚫🟣🟡🟠🔵🟤🟢), I cheated a little and added pink and gray as two rounded divs.
<li>Fears of numbers are in vast majority, almost every number has its phobia. To not bloat my game with such phobias, I kept the list simple: every number from 0 to 20, plus 30, 69, 99, 100 and 666. I represented them with Emoji digits.
<li>Some phobias could not be easily represented by a single emoji, but sometimes a non-emoji unicode character could do the trick (ex: wind ࿓༄  , stairs 𓊍...), or a combination of multiple emoji (ex: accidents 🚗💥🚗, being tickled 👣🪶, constipation 💩❌...), or even a mix of emoji and non-emoji characters (ex: dust .･:･🧹). Many combos were found thanks to the help of <a href="https://emojidb.org/">emojidb</a>.
</ul>

<br><br><hr><br>
<p><b>Final list and categorization</b>

<p>After cleaning up the majority of phobias that didn't correspond to an emoji (for example: fear of imperfection, 
fear of being forgotten, fear of missiles, fear of coitus, fear of hearing good news, fear of novelty, etc...), and gathering together the ones that had multiple names, I arrived to a total of 280 emoji, with corresponding name(s) and definitions.

<br><br>
<br><img src=images/js13k24/45.png width=900>
<br>
<br>

<p>After adding them into different categories (Easy / medium / hard / colors / animals / numbers / countries), they formed my <a href="https://github.com/xem/js13k24-phobia/blob/gh-pages/index.html#L191-L519">final list</a>, and I was finally ready to start working on my game!

<br><br><hr><br>

<p><b>New game design</b>

<p>While working on my list, I thought about this shop idea and wondered how long it would be fun to play it... For me, it would be too limited or repetitive. But if we reduce the concept to its simplest form possible, what is the game about? It's about matching phobias and emoji. In that case, why not drop the shop idea completely and make a quiz game?
<p>Sure, a quiz game where we match emoji and phobia names can be repetitive too, but I can surely find 13 original ways to ask my questions.
<p>Here's my original ideas list:
<ul>
<li>Name my phobia! You see an emoji and need to find the right name among 3.
<li>Scare me! You see a name and must pick the correct emoji among 3
<li>Save me! You see a phobia name and must find its solution
<li>Which phobia exists? You see 3 phobias emoji and find the real one
<li>Which phobia doesn't exist? You see 3 phobias emoji and find the false one
<li>Which phobia exists? You see 3 phobias names and find the real one
<li>Which phobia doesn't exist? You see 3 phobias names and find the false one
<li>name that phobia: rearrange syllabs
<li>Who do I scare? see a phobia name and pick who is affected by it
<li>Xenophobia: find the correct flag
<li>name my phobia: rearrange letters
<li>Scare me! You see a name and must pick the correct emoji in all the keyboard
<li>name that phobia: type the phobia name
<li>Associate 3 phobias with the right name (3 vs 3)
<li>find the phobia accociated to the right name (2 wrong / 1 correct)
<li>Numerophobia: fear of numbers
<li>Chromophobia: fear of colors
</ul>

<p>The best (and most doable) ideas ended up in the final game, with a few additions (to address the easy, medium and hard categories more explicitly).
<p>The ideas where we have to rearrange letters or syllabs to form words, or to match N emoji with N names on the same screen were too complicated. I liked the ideas of "finding the solution to that phobia" or "find who is affected by that phobia" but in practice, these questions were too vague and not super interesting to answer.

<br><br><hr><br>

<p><b>Development</b>

<p>I spent the last 5 days creating the visual identity of the entry, and implementing the title screen, the encyclophobia, the 13 questions one by one, the sudden death part and the score screen (with a basic web3 leaderboard). 

<br><br>
<br><img src=images/js13k24/46.png width=900>
<br>
<br>

<p>To be a bit more technical, there's no canvas, it's all HTML and CSS.
<p>It's fully responsive and (as always) uses the Twemoji webfont polyfill to ensure a similar display on all devices and OS's.
<p>It's playable on mobiles too, but a weird bug happens on iPhones, on the title screen. Even if I force my title's text to be written in black with CSS, for some reason, the characters placed after an emoji get colored with the main color of the emoji. That's unexplainable, and probably unfixable in a reasonable amount of time, so I kept it like that.

<br><br>
<br><img src=images/js13k24/47.png width=500>
<br>
<br>

I remarked after the release that the title is too big for some Linux players (but not on all browsers). I don't understand how it's possible, since the title is supposed to be centered. For these people, the title screen will stay like that:

<br><br>
<br><img src=images/js13k24/54.png width=500>
<br>
<br>

<p>Besides that, the only little challenge that I encountered in this entry was data management. Each question displays one or many emoji plus one or many phobias names, but I didn't want them to appear twice in the game.
<p>So after each question, all the phobias that appeared in the question (with their name or their emoji) get deleted from the global data object. 
<p>When the 13 questions have passed, 250 phobias remain in the "data" object, still grouped by categories.
<p>At this moment, the categores get grouped  by increasing order of difficulty, then randomly ordered, and put in in a big "suddendeathquestions" array:

<pre class=language-js><code>suddendeathquestions = [];

// All the easy ones
suddendeathquestions.push(...[...data.easy, ...data.animaleasy, ...data.numbereasy].sort((a,b)=>0.5 - Math.random()))

// All the medium ones
suddendeathquestions.push(...[...data.medium, ...data.color, ...data.country].sort((a,b)=>0.5 - Math.random()))

// All the hard ones
suddendeathquestions.push(...[...data.hard, ...data.numberhard].sort((a,b)=>0.5 - Math.random()))</code></pre>

<p>After that, sudden death mode starts, and questions are taken 3 by 3 in this array, and deleted after each correct alswer, allowing for about 80 good answers before the game runs out of questions and displays the final score.

<br><br><hr><br>

<p><b>Release</b>

<p>As for my first entry, 10 days were enough to complete and polish my quiz.
<p>This time, no golf or minification were needed at all, since the unminified file (containing 1451 lines of code) was 51kb unzipped and 10.7 kb zipped. As a result, the released entry contains my raw source code.

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">This edition of <a href="https://twitter.com/hashtag/js13kgames?src=hash&amp;ref_src=twsrc%5Etfw">#js13kgames</a> definitely can&#39;t keep me occupied for more than 10 days at a time. So I&#39;ll make 3 entries!<br><br>- Days 1-11: GREAT PLUMBER 65 (preview: <a href="https://t.co/EwVwQBynTO">https://t.co/EwVwQBynTO</a>)<br><br>- Days 11-22: EMOJIPHOBIA (<a href="https://t.co/FE24Xv46uh">https://t.co/FE24Xv46uh</a>)<br><br>- Days 22-31: 🛹🤫<br><br>Feedbacks welcome! <a href="https://t.co/4Ro1yFqjDz">pic.twitter.com/4Ro1yFqjDz</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1831383334112653667?ref_src=twsrc%5Etfw">September 4, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 

<p>Let's go for a third entry? Slack was amused by this idea...

<br><br>
<br><img src=images/js13k24/3.png width=500>
<br>
<br>

<br>
<br>
<hr>
<br>
<p><h2 id=game3>DAYS 22-31: O HIII BAD SKATEPARK</h2>
<br>
<hr>

<br>
<p><b>A new tool approaches</b>

<p>Before starting my third game, I realized that my two first entries and had a similar structure:
<br>- Single-file
<br>- SVG favicon
<br>- Emoji polyfill
<br>- State management
<br>- Click handler
<br>- Disabled touch/text-select events

<p>Great Plumber 65 also has a useful keyboard management system and a 60 fps game loop.

<p>So before starting my third game, I wanted to try making a game template with all these features in a small package.

<p>It took me a few hours to make <a href="https://github.com/xem/miniGameTemplate?tab=readme-ov-file#minigametemplate">MiniGameTemplate</a>, 100 lines long with comments, 0.8kb minified, and 0.6kb zipped.
<p>I think it has everything needed to start making a game in great conditions, and I'll definitely use it for my future games!


<blockquote class="twitter-tweet" data-conversation="none" data-theme="dark"><p lang="en" dir="ltr">I wrote a 2024 update for my 100-lines HTML5 game template:<a href="https://t.co/6DgTELfrRp">https://t.co/6DgTELfrRp</a><br>- Standalone<br>- SVG favicon<br>- Twemoji polyfill<br>- Disable text select &amp; touch gestures crap<br>- Keyboard input manager<br>- State machine + 60fps game loop/click handler <br>- 0.8kb minified<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://twitter.com/hashtag/gamedev?src=hash&amp;ref_src=twsrc%5Etfw">#gamedev</a> <a href="https://t.co/6VtDuBtPin">pic.twitter.com/6VtDuBtPin</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1831670699531870526?ref_src=twsrc%5Etfw">September 5, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 

<hr>
<br>
<p><b>Title screen</b>
<p>Let's start my skate entry with a title screen showing that the game's name is an annagram of the theme! (it wouldn't have much interest otherwise).
<p>I wrote TRISKAIDEKAPHOBIA and O HIII BAD SKATEPARK on a 2D canvas, as a model.
<p>Then for each letter, I measured and saved in a JS array its X position in the first text and in the second one.

<br><br>
<br><img src=images/js13k24/48.png width=800>
<br>
<br>

<p>(Note: the upppercase "i" didn't have dots by default. I added a white rectangle on each "i" myself to make the "HIII" / "Hiii" more readable)

<p>I first tried making all the letters move straight to their final position at the same time, with a lerp (linear interpolation), but it wasn't clear enough and the movement was too rigid.

<br><br>
<br><img src=images/js13k24/49.gif width=600>
<br>
<br>

<p>So I found a smooth lerp function online, and used it to make each letter move one after another, as if they were pushed by a man on a skate (represented by a dancer emoji and a skate emoji).

<br><br>
<br><img src=images/js13k24/50.gif width=600>
<br>
<br>

<p>Then, to add the idea that the levels will be drawable with the mouse, I added a crayon drawing a line, and made the skater ride on that line (as you can see in the final game, with the proper emoji webfont and a subtle radial gradient in the background).

<br><br>
<br><img src=images/js13k24/51.png width=800>
<br>
<br>

<p>To conclude this screen, I wanted to add a cool 3D shadow effect on the text. 2D canvases can't do that natively, but the "drawImage()" function can be used to isolate a line of pixels and redraw it in another place, with a different scale and a different opacity, just like a "Mode 7" game would have done on the Super Nintendo!

<p>After a few hours of trial and error, I managed to make a convincing shadow for the title and the "PLAY" button using this technique. I even made it appear progressively at the end of the intro.

<br><br>
<br><img src=images/js13k24/52.png width=800>
<br>
<br>

<p>Unfortunately, after developing my title screen with Chrome, I tested it on Firefox and the browser got completely stuck when the shadows appeared. It wouldn't even accept click events on the "PLAY" button anymore. A complete freeze, everytime. I even tried disabling the game loop entirely, but no luck: Firefox even froze if the shadows were drawn during a single frame.
<p>I concluded that Firefox probably has a bug or a memory leak that prevents to do so many "Mode 7"-ish things on its 2D canvas without freezing. As a result, I added a Firefox user-agent check in my code. Every browser gets the shadows, and Firefox doesn't get any.

<br>
<br>
<br>
<hr>
<br>
<p><b>Editor and player</b>

<p>Little by little, I made my editor interface, with a basic JS state machine allowing me to activate buttons, draw lines and circles with the mouse, scroll with the arrow keys, then undo, clear, load, save (in JSON)... and finally, a "play" button to launch the 2D physics simulation, and a "return to editor" button to stop it.

<br>
<br>
<video src=images/js13k24/55.mp4 controls width=600></video>
<br>
<br>

<p>I hesitated a lot about keeping the skater and the skate as two separate entities or keep them glued together, but when I finally made the final graphics for the skate and the skater, it appeared obvious that it was much more interesting to see them being independant.

<br>
<br>
<video src=images/js13k24/56.mp4 controls width=600></video>
<br>
<br>

<p>The biggest "math" challenge I had to face was: how to convert a line drawn in my editor (going from a point A to a point B) into an equivalent rectangle (with a center position, width, height and angle) compatible with Mini2DPhysics?
<p>The solution arrived relatively quickly, by taking each item separately:
<br>- the rectangle's center point is at the middle of points A and B: center.x = (A.x+B.x) / 2; center.y = (A.y+B.y) / 2.
<br>- the rectangle's width can be measured with the dist() finction already present in the physics engine: w = dist(A, B)
<br>- the height is a constant, equal to the line's width: h = 8
<br>- and finally, the angle is Math.atan2(B.y-A.y, B.x-A.x).<br>(the atan2 method is magic for finding angles from lines! It's just super weird that its parameters are atan2(y,x) and not atan2(x,y) ...?!)



<p>Once again, I asked my friend <b>KorHosik</b> what else could be added to offer a better experience to the player, and he hit me with some good ideas: 
<br>- Allowing to scroll vertically using the mouse wheel
<br>- Replacing the "undo" button with an "erase" tool.
<br>- Showing a ghost of the skater in the editor to see where we should place the next lines
<br>- Add some kind of missions, such as reaching a certain zone or using a limited set of items to do something... to have a real game and not a "basic" Line Rider clone.

<p>I implemented all these ideas, the most complex being the "missions" (or "challenges", as I called them). I had to invent them, make sure they were doable, then implement all the tests in the simulation to check if a challenge is cleared or not.

<br><br>
<br><img src=images/js13k24/57.jpg width=900>
<br>
<br>

<p>I started with 3, then with my friend's help, I ended up with 10 challenges in total, from very easy ones to super difficult.
<p>To match the theme a little more, I decided that all these challenges had to be completed under 13 seconds, and with a maximum of 13 drawn items. 
<p>Some of them were actually hard to achieve AND hard to check for their completion, like this one where we must return the skate and land the skater, standing up, on it.


<p><b>Challenge solution (SPOILERS)</b> 
<br>
<br>
<video src=images/js13k24/58.mp4 controls width=600></video>
<br>
<br>

<p><b>JS code to check its completion:</b>
<br>
<br>

<pre class=language-js><code>// Check challenge 3 completion
   
if(
  challenge3 == 0 // challenge not yet completed
  && objects.length &lt;= 15 // less than 13 items drawn (15 simulated objects including skater and skate)
  && frame &lt; 13*60 // less than 13 seconds
  && objects[0].G > 2.7 && objects[0].G &lt; 3.5 // skater is standing up (-ish)
  && (objects[1].G > 5.5 || objects[1].G &lt; .5) // skate is upside-down (-ish)
  && distance(Vec2(objects[0].C.x, objects[0].C.y), Vec2(objects[1].C.x, objects[1].C.y)) &lt; 35 // skater is close to the skate
  && objects[1].C.y &lt; objects[0].C.y // skater is on top of the skate
){
  challenge3 = 1; // Challenge 3 is completed
  localStorage.hiii_3 = 1; // save in local storage
  ch3.setAttribute("checked", "true"); // check box in the challenge page
  challengeok.className = ""; // show popup
  challengeok.innerHTML += "Challenge cleared: flip the skate upside-down then make the skater stand up on it";
}</code></pre>

<br>
<br>
<p>Since some of them involved touching a certain number of balls with the skater, with limited time and items drawn, my friend suggested that I show the number of items drawn in the editor and the elapsed time in the simulation, and color the balls differently when they get touched, so we can see more clearly how many balls are completing the "touch X balls" challenges. (this "blue balls" thing ended up becoming a joke in the game's feedbacks).

<br>
<br>
<video src=images/js13k24/59.mp4 controls width=600></video>
    
<br>
<br>
<br>
<hr>
<br>

<p><b>Release</b>
<p>After doing all the debugging and polishing I was able to make, I zipped my unminified 1412 lines, 44kb index.html (which was also developed as a single-file) into a 11.2kb zip and released it like that, the day before the deadline!
<p>My friends and I tried it with many, MANY items and I was pleased to see that the simulation remained super stable and fluid, even in a pool full of balls or a big track with plenty of lines.
<p>I was especially proud of the challenges that were kind of added in the last minute, because without them the game would have been much less fun to play.

<blockquote class="twitter-tweet" data-theme="dark"><p lang="en" dir="ltr">My three entries are released, here are the final links to test them<br><br>- GREAT PLUMBER 65: <a href="https://t.co/IndmLmSyx0">https://t.co/IndmLmSyx0</a><br><br>- EMOJIPHOBIA: <a href="https://t.co/DnlVJgdYwG">https://t.co/DnlVJgdYwG</a><br><br>- O HIII BAD SKATEPARK: <a href="https://t.co/atCn9M6oeZ">https://t.co/atCn9M6oeZ</a><br><br>(also available on <a href="https://t.co/Pxww9vnFai">https://t.co/Pxww9vnFai</a> &amp; <a href="https://t.co/jpaqewsvdT">https://t.co/jpaqewsvdT</a>)<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://t.co/P2NAiVfnDV">pic.twitter.com/P2NAiVfnDV</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1834468828199170152?ref_src=twsrc%5Etfw">September 13, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 

<br>
<hr>
<br>
<p><h2 id=conclusion>CONCLUSION</h2>
<br>
<hr>
<br>
<p><b>Productivity</b>
<br>
<p>I believe 2024 was the year where I produced the most lines of code for js13k: 3 tools, 3 entries, 4 dweets and this (too long?) making-of!
<br>
<br>
<hr>
<br>

<p><b>The sound of JS13k24</b>
<br>
<p>- I contributed to the js13k24 soundtrack album with my GREAT PLUMBER 65 intro and outro, and my EMOJIPHOBIA classical music (stolen from LOSSST 2021). I didn't add O HIII BAD SKATEPARK's music because it was already present in EMOJIPHOBIA (I realized AFTER the jam that I used the same song twice, once taken from a preious entry, and the other one... recreated from a MIDI file. 🤦)
<p>- end3r showed us suna.com, an AI site that generates songs from a prompt: lyrics, music, vocals, rhymes, everything. I tried it myself with a prompt containing js13k24's theme (phobia of thirteen), and a few details about the jam (theme announcement, limited time and space, creating tools, using VR, AI, procedural generation, coding, creating assets, debugging, playtesting and finally, writing post-mortems.
<p>It's an euphemism to say that I was extremely impressed by the song that came out of this prompt. You can find it <a href="https://suno.com/song/9cef13b6-1e3a-4d42-9851-2e97b8db97f8">here</a>, or play it below:


<br>
<br>
<video src=images/js13k24/60.mp4 controls width=500></video>
<br>

<p>Some feedbacks on the song:
<p><b>CarelessLabs</b>: That’s awesome. It’s so catchy! 
<br><b>John Edvard</b>: 13 bytes and sleepless nights. Quite accurate.
<br><b>Tricsi</b>: catchy
<br><b>end3r</b>: damn that's so good!

<br>
<br>
<hr>
<br>
<p><b>My favourite entries</b>
<br>
<p>I spent the days following september 13th testing and voting for all the entries submitted during the jam. When <b>Alkor</b> released some stats at the end of september, I was the top 1 voter on the app, haha!
<p>I remarked that the overall quality was pretty high this year. I found 24 outstanding games, and <a href="https://x.com/MaximeEuziere/status/1834585315434016795">posted them on X</a>:
<br>
<p>- <a href="https://dev.js13kgames.com/2024/games/economy-of-motion">Economy of motion</a> (One of my ideas this year was to make a game where we're limited to 13 moves. Glad to see this entry achieve it as a 2D platformer!)
<br>- <a href="https://dev.js13kgames.com/2024/games/cooler">Cooler</a> (Nice controls & music!)
<br>- <a href="https://dev.js13kgames.com/2024/games/squad-13">Squad 13</a> (Amazing helico simulation, particles system and audio, reminds me old Choplifter games.)
<br>- <a href="https://dev.js13kgames.com/2024/games/dimension-13">Dimension 13</a> (Difficult and sadly WASD-only, but retro-pigeon delivers really impressive visuals in 13kb and at 13yo!)
<br>- <a href="https://js13kgames.com/2024/games/ghosted">Ghosted</a> (I hate sokoban but love good twists on sokoban's rules. Well done. A bit hard.)
<br>- <a href="https://js13kgames.com/2024/games/those-final-seconds">Those final seconds</a> (The graphics are amazing)
<br>- <a href="https://js13kgames.com/2024/games/brewing-disaster">Brewing Disaster</a> (Simple concept, good variety of characters, items, effects and challenges)
<br>- <a href="https://js13kgames.com/2024/games/unloved-13">Unloved 13</a> (Lovely idea, cute graphics, story and music)
<br>- <a href="https://js13kgames.com/2024/games/dungeon-of-curse">Dungeon of Curse</a> (Impressive graphics)
<br>- <a href="https://js13kgames.com/2024/games/kyabetsu">Kyabetsu</a> (Yay, a cute point&amp;click game)
<br>- <a href="https://js13kgames.com/2024/games/coup-ahoo">Coup Ahoo</a> (A kind of game I hadn't seen before, cute and nice music)
<br>- <a href="https://js13kgames.com/2024/games/escape-from-planet-xiii">Escape from planet XIII</a> (Super impressive graphics and tech.)
<br>- <a href="https://js13kgames.com/2024/games/cool-dolphin">Cool dolphin</a> (I liked the graphics and controls)
<br>- <a href="https://js13kgames.com/2024/games/sup3rfr1ght-vr">SUP3RFR1GHT VR</a> (Couldn't play it as it's VR but seems amazing)
<br>- <a href="https://js13kgames.com/2024/games/cursed-elevator">Cursed Elevator</a> (Wow, an impressive entry using my tools W and pxtex! Graphics, sounds and ambiance are amazing. Boss fight is a bit long.)
<br>- <a href="https://js13kgames.com/2024/games/the-kings-crowns">The king's crowns</a> (Incredible graphics and ambiance)
<br>- <a href="https://js13kgames.com/2024/games/13th-floor">13th floor</a> (Incredible graphics and ambiance. "it" made me chilly!)
<br>- <a href="https://js13kgames.com/2024/games/deep13">Deep13</a> (Here too, amazing visuals and atmosphere)
<br>- <a href="https://js13kgames.com/2024/games/phantomicus">Phantomicus</a> (Amazing hommage to Luigi Mansion, is that a real 3D physics engine?! I want to see its source code with a standalone demo!)
<br>- <a href="https://js13kgames.com/2024/games/bubble-burst">Bubble burst</a> (Curious to know how the bubble is implemented!)
<br>- <a href="https://js13kgames.com/2024/games/king-longlegs">King LongLegs</a> (Very interesting platformer with some depth)
<br>- <a href="https://js13kgames.com/2024/games/sub13">Sub13</a> (Awesome 3D ans music, too bad the power ups look like walls)
<br>- <a href="https://js13kgames.com/2024/games/do-not-make-13">Do not make 13</a> (Very original concept with maths and drawings)
<br>- <a href="https://js13kgames.com/2024/games/dr1v3n-wild">Dr1v3n wild</a> (Spectacular "false" 3D graphics with a lot of variety. Convincing gameplay and sound. Cute billboards.)


<!--
Remarks:

Mvasilkov: @xem takes the entire top-10 this year :)

Feedbacks on emojiphobia:

Cody: fun quick game, I feel like I learned something

Feedbacks on Great Plumber 65:

Cody: Very impressive opening sequence. He does flips and yahoos! Looking great! 😍

Joao: pretty amazing :sourire: a bit too much for my poor computer maybe

Remvst: the sound effect when you hit "start" really hurts my ears (...) the rest of the demo is super impressive

Curtastic: The raw emotion in Plumber's voice when he says woohoo is the best part

Herebefrogs: I love it that you still manage to sneak emoji everywhere

bb: Wow, Great Plumber 65 is a work of art... Amazing

https://www.youtube.com/watch?v=HT2HMWjh2ls
https://www.youtube.com/watch?v=aB_I3mn5HI8

https://www.twitch.tv/invadium

https://js13k.bandcamp.com/album/triskaidekaphobia-js13k-2024

https://openclassrooms.com/forum/sujet/image-dans-un-select-10327

https://github.com/codyebberson/js13k-3dphysics-for-xem
live demo: https://js13k-3dphysics-for-xem.vercel.app/

https://suno.com/song/fb201967-958c-44e9-beea-deb52240b936
https://suno.com/song/5b122393-60de-4fef-95cd-1c3ebc958d87
https://suno.com/song/9cef13b6-1e3a-4d42-9851-2e97b8db97f8

[Verse]
Late night coding for the game jam
Thirteen kilobytes the goal
Compress it down respecting theme
Each line of code a story told

[Verse]
Theme drops panic in the air
Competitors unaware
Seconds tick feel the heat
Ideas flash computers greet

[Verse]
Fear of thirteen runs so deep
Bytes and bits in dreams they creep
Graphics tight and music clear
One month to conquer all the fear

[Chorus]
Thirteen bytes and sleepless nights
Code the dreams take flight
Phobia diminishing
In the game we’re finishing

[Verse]
Tools created by the team
Code and assets in the dream
VR worlds AI brains
Physics engines drive insane

[Verse]
Design so slim yet rich and grand
Every pixel by my hand
Puzzle play and tension high
In our small world you must try

[Bridge]
Procedural worlds set us free
Game dev magic hard to see
Laughs and tears the journey great
In this jam we create

[Chorus]
Debug nights assets flow
3D worlds they start to glow
Thirteen kilobytes to fit
Masterpieces bit by bit

[Verse]
Debugging till the morning rise
Each solution a surprise
Soundtrack echoes as I type
Rhythms match the coder’s vibe

[Verse]
Playtesters join the fun
Feedback given empires run
Emoji rain for top of line
Votes and ranks we shine we climb

[Verse]
Post-mortem tales we write
Chasing dawn through endless nights
Every glitch and every leap
Coding mountains feeling steep












-->

</div>


</main>

</div>

<footer></footer>

<script src="../ui.js?v=2024-07"></script>
<script>
header();
footer();
menu();
</script>
<style>
.inline, .inline * { display: inline; padding: 2px !important; }</style>
</body>
</html>