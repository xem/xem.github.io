<!doctype html>
<meta charset=utf-8>
<meta name="viewport" content="width=device-width, user-scalable=no">
<html>
<head>
<link rel=stylesheet href="../style.css?v=2024-07">
<title>Maxime Euzière</title>
<base target=_blank>
</head>
<body>

<style>
.twitter-tweet { margin: 30px 0 !important; border: 3px solid #ccc; border-radius: 30px; overflow: hidden; transform: scale(.95)}
ul { padding-left: 15px }
</style>

<div class="wrapper">

<header></header>

<div id=menu></div>

<main>

<div class=section id=codegolfctober18>

<h2>JS13k'24: GREAT PLUMBER 65, EMOJIPHOBIA & O HIII BAD SKATEPARK</h2>
<br><h3>August-September 2024</h3>
<br><hr><br>
<img src="images/js13k24/cover.jpg" width=500>
<br>
<br>
<hr>
<br>
Hello! It's the 13th edition of JS13KGames. The theme is <b>Triskaidekaphobia</b> (the phobia of number 13).
<br>
<br>
<hr>
<br>
<h3>TL;DR</h3>

<p>This year I released 3 entries:
<p>- <a href="https://dev.js13kgames.com/2024/games/great-plumber-65">GREAT PLUMBER 65</a> (a 3D platformer tech demo inspired by a childhood game, ranked ...th)

<br>- <a href="https://dev.js13kgames.com/2024/games/emojiphobia">EMOJIPHOBIA</a> (a quiz game about phobias... and emoji, ranked ...th)

<br>- <a href="https://dev.js13kgames.com/2024/games/o-hiii-bad-skatepark">O HIII BAD SKATEPARK</a> (a "Line Rider" clone with skates and extra challenges, ranked ...th)

<p>... and 3 new tools:

<p>- <a href="https://xem.github.io/pxtex/">Pxtex</a>: a random pixelized texture generator

<br>- <a href="https://xem.github.io/microW/">MicroW</a>: a basic WebGL renderer in less than 1kb

<br>- <a href="https://github.com/xem/miniGameTemplate">MiniGameTemplate</a>: a modern, editable HTML5 game template in just 100 lines of code


<br>
<br>
<hr>
<br>
<h3>The full story (with spoilers)</h3>

<p><b>JULY 2024</b>

<p>At the beginning of July, I hadn't really been able to enjoy coding for a couple years, and had serious doubts about competing to js13kgames this year. Focusing on code had become too hard for me.
<p>By chance, I stumbled upon <a href="https://www.youtube.com/watch?v=b0hL4mJInm0">JaidenAnimations video "I found out I have ADHD."</a>, which made me decide to consult a specialist, get an actual ADHD diagnosis, and the appropriate medication.
<p>And it was exactly what I needed. After a couple days, my brain was fixed and I was again (actually, more than ever) able to think, focus and create stuff, many hours a day... and do it with actual pleasure!
<p>JS13K 2024 is officially uncancelled! Get ready for an unusually productive summer...
<p>While waiting for JS13k to start, I spent most of July replaying every single JS game I had made for the past 10 years, <a href="https://x.com/MaximeEuziere/status/1807668217734660294">in the form of a X thread</a>. The playthroughs durations range from a couple minutes to almost <a href="https://www.youtube.com/watch?v=nznC5jv0Vg8">3 hours</a> (for my 2021 entry LOSSST).
<blockquote class="twitter-tweet" data-theme="dark" data-media-max-width="560"><p lang="en" dir="ltr">On august 13th starts the 13th edition of <a href="https://twitter.com/js13kGames?ref_src=twsrc%5Etfw">@js13kGames</a>.<br>I&#39;ve also been making code golfed JS games for 10 years.<br>Instead of a tips/tools thread, I will do a thread of me replaying all the games that I have developed so far and see if thay still work and if I can beat them in 2024!</p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1807668217734660294?ref_src=twsrc%5Etfw">July 1, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 
<p>I was overall very pleased to rediscover my old creations, most of them being playable in 2024 and offering a real experience to the player (especially the ones released since JS13K 2015).
<br>
<br>
<hr>
<br>
<p><b>AUGUST 2024</b>
<br>
<p>August has arrived, and there are another 13 days to wait until the start of the jam. How about working on tools that could become handy if I make an actual 3D WebGL entry this year? (after 7 years of making all my 3D games with CSS3D)
<p>The vague idea of an entry inspired by Mario 64 has been in my head for many years, and if I actually try to do it in this edition of JS13K, one thing I will need for sure is a tiny pixellized texture generator to represent surfaces like rock, grass, sand or water. LOSSST 2021 used <a href="https://codepen.io/collection/DRMKdB">Bence's amazing SVG textures</a>, but this time I want something much, much smaller, more generic, and pixel-y!
<p>And that's how I invented <a href="https://xem.github.io/pxtex/">ptex</a>: a 228 bytes long JS function that takes a HTML canvas, a HSL color, a noise coefficient and a size, and outputs some yummy randomized pixel-art textures ready to use as base64 pngs.
<br><br>
<p><img src=images/js13k24/4.png width=600>
<br><br>
<p>The tool is actually as simple as it sounds (it draws colored squares on a canvas), but was still very well received in the js13k community:
<p>- It was featured in GamedevJS's newsletter and on X:
<blockquote class="twitter-tweet" data-theme="dark" data-media-max-width="560"><p lang="en" dir="ltr">Just before the start of <a href="https://twitter.com/js13kGames?ref_src=twsrc%5Etfw">@js13kGames</a> tomorrow, long time participant and legendary creator of multiple useful mini tools, <a href="https://twitter.com/MaximeEuziere?ref_src=twsrc%5Etfw">@MaximeEuziere</a>, released another one: Pxtex – mini randomized pixel-art textures.<a href="https://t.co/6PKkqfZsyB">https://t.co/6PKkqfZsyB</a><a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://twitter.com/hashtag/gamedev?src=hash&amp;ref_src=twsrc%5Etfw">#gamedev</a> <a href="https://twitter.com/hashtag/gamedevjs?src=hash&amp;ref_src=twsrc%5Etfw">#gamedevjs</a> <a href="https://twitter.com/hashtag/JavaScript?src=hash&amp;ref_src=twsrc%5Etfw">#JavaScript</a> <a href="https://twitter.com/hashtag/codegolf?src=hash&amp;ref_src=twsrc%5Etfw">#codegolf</a></p>&mdash; Gamedev.js (@Gamedevjs) <a href="https://twitter.com/Gamedevjs/status/1822996864787947820?ref_src=twsrc%5Etfw">August 12, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 

<p>- And another dev, Lewis Nakao, made <a href="https://lewdev.github.io/apps/pxtex-tool/">a cool UI around it</a>:
<blockquote class="twitter-tweet" data-theme="dark" data-media-max-width="560"><p lang="en" dir="ltr">Just so I could play around with <a href="https://twitter.com/hashtag/pxtex?src=hash&amp;ref_src=twsrc%5Etfw">#pxtex</a> by <a href="https://twitter.com/MaximeEuziere?ref_src=twsrc%5Etfw">@MaximeEuziere</a>, I made a tool and figured it might be useful to others in the <a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a>. I had to figure out the &quot;max&quot; values for each parameter. The Hue value wraps at 360.<br><br>⛏️ <a href="https://t.co/PH0IJ7OgRN">https://t.co/PH0IJ7OgRN</a><br><br>Source Code: <a href="https://t.co/bNfMNPXFgJ">https://t.co/bNfMNPXFgJ</a> <a href="https://t.co/PpBB7np7Zz">pic.twitter.com/PpBB7np7Zz</a></p>&mdash; Lewis Nakao (@lewdev) <a href="https://twitter.com/lewdev/status/1825480343014854919?ref_src=twsrc%5Etfw">August 19, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>The second tool that I wanted to make is an absolute minimal WebGL boilerplate to display 3D shapes on screen.<p>I created <a href="https://xem.github.io/W/">W.js</a> in 2020 with the help of <b>@Stas</b> and <b>@Kchplr</b>, which was full of cool features and as small as possible (2kb zipped), but I wanted to see how low we could go by keeping only the bare essentials:
<p>- Render planes and cubes out-of-the-box
<br>- Render custom 3D models based on vertex / uv arrays
<br>- Coloring, texturing and support for transparency
<br>- Easily set camera and objects' position, rotation and scale.
<br>- Automatic shading from diffuse and ambient light
<p>The features left out are: billboards, animations, smooth shading, normal arrays, indexed models and groups.<p>They were amazing features of course, but took too much space.
<p>I first tried to start om W's source code and trimming everything I didn't need, but the result remained too verbose. So I restarted from scratch, with a different model.
<p>Now, the scene (with its clear color, camera, light and 3D objects) is entirely defined in a JSON object.
<p>WebGL's z-index is not friend with transparency. W.js had a built-in function reordering every item on-the-fly, but here, to make things simpler, the objects with transparency just need to be declared in the correct order (from back to front) to be displayed properly.
<p>The library only contains a function called <b>W.render()</b>, that can easily be called once, or 60 times per second for a game loop, and the cube's 3D model. (the plane model comes for free, by ony rendering the front face of a cube). 
<p>Thanks to these extreme simplifications, I was very proud to see the result fit in 1kb zipped.
<p>I released it with 3 interactive demos and called it <a href="https://xem.github.io/microW/">MicroW</a>.
<br><br>
<p><img src=images/js13k24/5.jpg width=900>
<br><br>
<blockquote class="twitter-tweet" data-theme="dark" data-media-max-width="560"><p lang="en" dir="ltr">New mini gamedev resource for <a href="https://twitter.com/Gamedevjs?ref_src=twsrc%5Etfw">@gamedevjs</a> &amp; <a href="https://twitter.com/js13kGames?ref_src=twsrc%5Etfw">@js13kgames</a> 2024...<br>MicroW: a WebGL renderer in less than 1kb!<br>- Built-in shapes (cube, plane)<br>- Custom shapes<br>- Coloring, texturing, alpha-blending, lighting<br>- Free position, transformation for camera &amp; objects<a href="https://t.co/X422ZQrODB">https://t.co/X422ZQrODB</a> <a href="https://t.co/I7GE5ZOPsA">pic.twitter.com/I7GE5ZOPsA</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1823244897375187331?ref_src=twsrc%5Etfw">August 13, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 
<p>Some feedbacks on MicroW:
<p><b>@mcfunkypants</b>: "WOW!!! amazing work!"
<p><b>@joao</b>: "Awesome :) i used your W in my gamedevjs entry this year"
<p><b>@mvasilkov</b>: "Epic as always :) I pledged I'd learn WebGL for this year's compo but alas :("
<p><b>@FrankForce</b>: "amazing work! i will be using this for reference as i am planning to go 3d this year!"
<p><b>@soylentgraham</b> showed me an even more compact way to declare the vertex coordinates of my 3D models, using gl_vertexid (skipping attribute buffers entirely):
<pre class=language-js><code>// GLSL cube
vec3 GetLocalPosition(int v){
  int x = ivec4(915775499,923195439,642272978,49129)[v/30]>>v%30;
  return sign(vec3(x&1,x&2,x&4));
}</code></pre>
<p>Seems magic. I'll look into this!
<p>Another challenge I started at the end of July is implementing my own 3D physics engine in JS (because all the existing ones weigh more than 100kb). I've read many <a href="https://www.amazon.com/s?k=physics+engine+game&crid=2629HQH2ISLU4&sprefix=physics+engine+game%2Caps%2C312&ref=nb_sb_noss_1">books</a> and <a href="https://gamephysicsweekend.github.io/">ebooks</a> related to this topic but didn't manage to get past collision detection yet.<p>I will try again later!
<br>
<br>
<hr>
<br>
<p><b>DWEETS</b>
<p>In early August, <b>@end3r</b> advertised js13kgames 2024 on Dwitter with <a href="https://www.dwitter.net/d/32204">a 140b countdown</a>.
<p>It gave me the idea to make a series of little Dweets to advertize the jam, too:
<p>- <a href="https://dwitter.net/d/32224">What are 13,312 bytes?</a>
<br>- <a href="https://dwitter.net/d/32232">Typical js13k project size</a>
<br>- <a href="https://dwitter.net/d/32234">JS13k logo</a> (using a Path2D) 
<br>- <a href="https://dwitter.net/d/32244">JS13k 2024 tshirt</a> (using a black t-shirt emoji and little red Unicode characters that look like gamepads)
<br><br>
<p><img src=images/js13k24/6.png width=900>
<br><br>

<p>While doing these, I also contributed to Dwitter with <a href="https://www.dwitter.net/d/32233">an easier-than-ever Dweet packer</a>: paste your code in the field (up to 194 ASCII chars) and it's instantly converted into a 140-chars snippet...
<br><br>
<p><img src=images/js13k24/7.png width=500>
<br><br>

<p>...and <a href="https://www.dwitter.net/d/32220">a dweet about olympic games</a> held in my country at that moment (I didn't have enough room to make the rings overlap correctly).
<br><br>
<p><img src=images/js13k24/12.png width=400>
<br>
<br>
<hr>
<br>
<p><b>DAY 1</b>
<p>It's finally August 13th! The theme is <b>Tristaidekaphobia</b> and it inspires me... nothing at all.
<p>I scribbled some vague ideas on my notepad such as "maths game", "fear game", "puzzle with 13 pieces", "puzzle where you're limited to 13 moves", "Apollo 13", "avoid number 13", "avoid good luck"...
<p>But nothing clicked do far.
<p>(At the end of the jam, I was pleased to see that other contestants had made very good games based on some of these ideas, and much better than I would have done myself.)
<br>
<p>I looked on <a href="https://wordsmith.org/anagram/index.html">Wordsmith.org</a> if there are good anagrams of the theme.
<p>Triskaidekaphobia contains the letters of interesting words such as <b>skateboard, skatepark, karate kid, bishop, parakite, parasitoid, idiopathies, apartheids, editorship</b> and <b>database</b>...
<p>It's hard to make a full sentence with these letters though.
<br>We can write weird things like:
<br>
<b>"I, bishop, karate kaid"
<br>"I'd hoist a bike parka"
<br>"A pariah debit kiosk"
<br>"It spied a khaki bro"</b>
<br>... or even...<br><b>"Bad skatepark, o hiii"</b>.
<p>None of these phrases really inspire me. The last one could maybe be a pretext to do a Line Rider clone... 
<p>While waiting for a better idea to come, I tried to make a quick prototype of 2D skate simulation based on my <a href="https://xem.github.io/mini2Dphysics/">Mini2DPhysics engine</a>, with the skate and the skater being two different entities, and found that it worked quite well! Who knows, it could become my plan B...
<br>
<br>
<video src=images/js13k24/1.mp4 controls width=600></video>
<br>
<hr>
<br>
<p><b>DAY 2</b>
<p>Hmm. Yeah, there's that skate idea, but it lacks some "Wow effect".
<p>I'd like to do something more impressive... such as the Mario 64 demake idea I've had for years...
<p>Then it hit me: Nintendo sometimes strikes the fan games that infringe their IPs. A deformed version of the theme could look like "Strika-Nintendoka-Phobia", which would be a made-up fear of being striked by Nintendo. Okay, let's do that!

<p>Let's make a pact with <s>the devil</s> <b>@end3r</b> to launch the project!
<br><br>
<p><img src=images/js13k24/1.png width=800>
<br>
<br>

<p>I'll show my progress on X and Slack, but I will hide all the Mario references, to avoid spoiling people! (even the Mario 3D model present in Midi3Dplatformer got replaced by a brown parallelepiped).
<p>Ideally, I'd like to do a complete demake of Mario 64 in 5 chapters, five actual JS13K entries that would be able to share data and assets with each other, and I would call the game something like "GREAT PLUMBER 65", because 65kb = 5 x 13kb. Though, I know the task would be too immense for a single dev, with such size and time constraints, so I'll probably go with something much smaller, in a single entry, but as impressive as possible. <a href="https://www.youtube.com/clip/UgkxzZJ4oTvJFhEzQ4Z3Pc-4iT2owIfoEPGO">The intro and castle's outdoors</a> will certainly be enough.

<p>I started by unearthing and connecting together two of the tools I invented a few years ago:
<p>- <a href="https://xem.github.io/3Dmapeditor/">3Dmapeditor</a>
<br>- <a href="https://github.com/xem/mini3DPlatformer">Mini3DPlatformer</a>
<br><br>
<p><img src=images/js13k24/8.png width=900>
<br><br>
<p>Both tools weren't made to communicate with each other, and do not share any code whatsoever (the former is made in CSS3D and the latter in WebGL), but I made them communcate through a common ASCII export that represents the level. 3Dmapeditor outputs it, and Mini3Dplatformer parses it to construct its scene.
<p>To make this (rather unholy) communication work as I want, I first had to make Mini3DPlatformer able to display different kinds of cubes (grass, sand, rock, roof and water).
<p>Then, I added slope blocks in both tools:

<p>In 3Dmapeditor, the edits made to my generic 200*200*200px cube consisted in hiding the up face, slanting the front face, and clipping the left and right faces as triangles, with CSS:

<pre class=language-css><code>/* slope */
.s3 .up { display: none }
.s3 .front { height: 282px; transform: translate3D(0,-82px,0) rotateX(-45deg) }
.s3 .left { clip-path: path('M0 0L200 200L0 200Z') }
.s3 .right { clip-path: path('M200 0L200 200L0 200Z') }</code></pre>


<p>In Mini3DPlatformer, which is based on W.js, I added the slope 3D model manually:

<pre class=language-js><code>// SLOPE
//
//  /\
// |\ \
// | \ \
// |  \ \
// |___\/

W.add("slope", {
  vertices: [
    .5, .5,-.5,  -.5, .5,-.5,  -.5,-.5, .5, // front
    .5, .5,-.5,  -.5,-.5, .5,   .5,-.5, .5,
    .5, .5,-.5,   .5,-.5, .5,   .5,-.5,-.5, // right
   -.5,-.5,-.5,  -.5, -.5, .5, -.5, .5,-.5, // left
   -.5, .5,-.5,   .5, .5,-.5,   .5,-.5,-.5, // back
   -.5, .5,-.5,   .5,-.5,-.5,  -.5,-.5,-.5,
    .5,-.5, .5,  -.5,-.5, .5,  -.5,-.5,-.5, // down
    .5,-.5, .5,  -.5,-.5,-.5,   .5,-.5,-.5
  ],
  uv: [
    1, 1,   0, 1,   0, 0, // front
    1, 1,   0, 0,   1, 0,            
    1, 1,   0, 0,   0, 1, // right
    0, 1,   0, 0,   1, 1, // left
    1, 1,   0, 1,   0, 0, // back
    1, 1,   0, 0,   1, 0,
    1, 1,   0, 1,   0, 0, // down
    1, 1,   0, 0,   1, 0
  ]
});</code></pre>

<br><br>
<p><img src=images/js13k24/14.png width=900>
<br><br>

<p>I ended the day by making a little sample level containing pretty much all the items I'll need in my entry: ground (made of grass, sand and water blocks), obstacles (walls and slopes) made of rock, and a billboard tree.
<p>This area will be my 3D platforming playfield for a few days! 

<br><br>
<p><img src=images/js13k24/15.png width=700>
<br><br>

<blockquote class="twitter-tweet"  data-theme="dark" data-media-max-width="560" data-lang="en"><p lang="en" dir="ltr">So I&#39;m unearthing the 3D map editor (in CSS) &amp; the 3D platformer template (in WebGL) that I started making years ago, and trying to connect the two.<br><br>If I don&#39;t get stuck, I&#39;ll try to make a 3D platformer that could maybe fit the theme.<br><br>Otherwise... I&#39;ll need a plan B!<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://t.co/m2P16YR9UY">pic.twitter.com/m2P16YR9UY</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1823803231174349287?ref_src=twsrc%5Etfw">August 14, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 

<br>
<br>
<hr>
<br>
<p><b>DAY 3</b>

<p>After yesterday's quick prototyping, let's include the unminified version of W.js and the code of mini3Dplatformer with my little sample level into my index.html file. Bam! It's already 31kb.

<p>Here, my little PoC (Proof of Concept) is taking shape, with ground collisions, (buggy) wall collisions, plus some basic character movement and rotations.
<p>Contrary to Mario 64, I took the liberty to always have the camera behind the character, otherwise the code required to make pleasant and fluid controls would have been too complex to implement.

<p>By the way, I'll keep using W.js (instead of MicroW) in my code because this project requires groups, animations and billboards, which are only present in W.js.

<blockquote class="twitter-tweet" data-theme="dark"><p lang="en" dir="ltr">DAY 3<br>Added movement, rotation, cube collisions and billboards (the tree plane always facing the camera).<br>Since it&#39;s a PoC, my collision code is still hacky.<br>To makes the slopes work, I have to rewrite it in a more clean and generic way.<br>Hopefully it&#39;ll be done tomorrow!<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://t.co/mznhUdf5WA">pic.twitter.com/mznhUdf5WA</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1824125900096495742?ref_src=twsrc%5Etfw">August 15, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 

<p>In the meantime, I secretly worked on the title screen of my entry. I wanted it to look like Super Mario 64's title, but with a different name (Great Plumber 65). Instead of drawing it on a canvas or using SVG, I decided to use a Web font specially created for this: <a href="https://www.fontspace.com/typeface-mario-64-font-f60208">Typeface Mario 64</a>.

<p>The font is in otf, weighs 10kb and contains way more characters than I actually need, so I searched (and found) a great software called <a href="https://fontforge.org/en-US/">FontForge</a>, which allowed me to edit the font, delete all the chars I didn't need and save it in woff2 format, reducing it to just 1.5kb!

<br><br>
<p><img src=images/js13k24/9.png width=700>
<br><br>

<p>With some HTML and CSS on top of this font (namely, custom colors, scale, letter-spacing, text-stroke and multiple text-shadows for the depth effect), I managed to make this (very convincing ?) title screen!

<br><br>
<p><img src=images/js13k24/10.png width=900>
<br><br>

<a href="https://xem.github.io/js13k24/1-intro/">LIVE DEMO</a> <p>(click to start! As a bonus, you'll see a little entrance animation and hear a coin sound from <a href="https://xem.github.io/MiniSoundEditor/">MiniSoundEditor</a>).
<p>The whole intro weighs 2.4kb zipped.

<p>I tried <a href="https://xem.github.io/js13k24/2-intro/">another version</a>, spelling the word StrikaNintendokaPhobia, but it was not as good.

<br><br>
<p><img src=images/js13k24/11.png width=500>

<p>In a desperate hope to save a few hundred bytes in my zip, I suggested <b>@end3r</b> to do a poll about allowing to load Webfonts for free, but it didn't convince enough people. So I'll keep my woff2 file on board!

<br><br>
<p><img src=images/js13k24/13.jpg width=500>
<br>

<p>I also made some quick tests of <a href="https://xem.github.io/miniSpeechRecognitionAndSynthesis/miniSpeechSynthesis/lang.html">speech synth</a> with a male and a female voice (before realizing how deep the rabbit hole of speech synth voices can be):

<br><video src=images/js13k24/2.mp4 controls width=300 height=200></video>
&nbsp; <video src=images/js13k24/3.mp4 controls width=300 height=200></video>

<br>
<br>
<hr>
<br>
<p><b>DAY 4</b>

<p>On day 4, I had so much progress to share that I made four X posts, instead of the usual 1 or 2.
<p>The first one shows how I added black debug spheres on every integer coordinate of the ground, and red ones at the corners of my hero. These spheres not only ensure that all the assets are well aligned with their coordinates (a 0.5 or 1 unit offset offset can easily go unnoticed!), they also surround the hero with an axis-aligned box (if you look closely, the red spheres never rotate with the hero, they stay aligned with the integer grid. This is the first step towards good collision detection.
<p>The second post shows a new set of (blue) debug spheres at the bottom of the hero. In fact, I implemented a "collision()" function that tells for any (x, z) coordinates, what's the height of the level geometry at these exact coordinates. The four blue spheres that follow the hero's bounding box, represent the result of this function. That's why you can see these spheres climb on slopes and cubes in the video (collisions were removed entirely at this moment).
  
<blockquote class="twitter-tweet" data-theme="dark"><p lang="en" dir="ltr">DAY 4<br>I added a blue set of debug spheres at the bottom corners of the AABB: at each frame, I place them at the height of the scenery block present at their coordinates (1 for cubes, 0 to 1 for slopes).<br>Now let&#39;s use that data to do the collisions and slopes work properly.<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://t.co/0SY7vs02ks">pic.twitter.com/0SY7vs02ks</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1824436056344731974?ref_src=twsrc%5Etfw">August 16, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 

<p>The "collision" function that computes the level's height at given coordinates was surprisingly <a href="https://github.com/xem/js13k24/blob/gh-pages/index.html#L1527-L1548">easy to implement</a> (it always returns 1 for cubes, and the decimal part of the X coordinate for a slope going to the east. the 3 other slopes directions are computed in a similar way, by using the decimal part of Z for a slope going to the south, and by substracting these values to 1 for the east and north slopes).

<p>The next step is to use the height of the blue spheres to interact with the environment:
<p>- hero.y represent the height of the hero's bottom (hero.y = 0 means that he's standing on the ground)
<br>- If a blue sphere has a height > hero.y + 0.2, a wall is hit. Stop moving.
<br>- If a blue sphere has a height between hero.y and hero.y + 0.2, we're at the beginning of a slope. Set hero.y to the height of the highest blue sphere.

<pre class=language-js><code>hero.y = Math.max(nw, ne, sw, se);</code></pre>

<p>I spent the rest of the day trying to make "sliding" wall collisions, because it feels weird to be completely stopped when we touch a wall in a platform game. It's much more pleasant to see the hero slide against it. To do so, I tried to apply an opposite force every time we try to walk against a wall. Unfortunately, it gets buggy every time we walk into a cube's corner. Both adjacent faces fail to properly reject the hero at the same time and he's able to walk inside the cube...

<blockquote class="twitter-tweet" data-theme="dark"><p lang="en" dir="ltr">DAY 4, part 4:<br>Sliding collisions against walls work almost fine, as well as going up and down slopes, and all it took was that small code on the left.<br>It&#39;s not perfect though (see at the end of the video, it still bugs a little from certain angles)<br>But enough for today!<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://t.co/7lEsbItZys">pic.twitter.com/7lEsbItZys</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1824510946284540193?ref_src=twsrc%5Etfw">August 16, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 


<hr>
<br>
<p><b>DAY 5</b>

<p>It took me many, many hours between days 4 and 5 to find the correct way to implement these (damned) sliding collisions, but I finally managed to do it. The good and probably unique way to do this properly and without bugs is this one:


<pre class=language-js><code>// At each frame
// (...)

// Save previous hero X and Z coordinates
lastx = hero.x;
lastz = hero.z;
        
// Go front / back
if(keys.u || keys.d){

  // Compute new deltaX and deltaZ based on hero's angle and walk speed
  dz = (-keys.u + keys.d) * Math.cos(-hero.rcamera*Math.PI/180) / 20;
  dx = (-keys.u + keys.d) * Math.sin(-hero.rcamera*Math.PI/180) / 20;
  
  // Add deltaX do hero.x
  hero.x += dx;
  
  // Check collisions all around the hero
  nw = (collision(hero.x-.15, hero.y, hero.z-.15));
  ne = (collision(hero.x+.15, hero.y, hero.z-.15));
  sw = (collision(hero.x-.15, hero.y, hero.z+.15));
  se = (collision(hero.x+.15, hero.y, hero.z+.15));
  
  // If one collision is with a wall ( > hero.y + 0.2 ) 
  if(
    nw > hero.y + .2 || ne > hero.y + .2 || sw > hero.y + .2 || se > hero.y + .2
  ){
  
    // Go back to the last non-colliding x position
    hero.x = lastx;
  }
  
  // Then do exactly the same with deltaZ and hero.z
  hero.z += dz;
  nw = (collision(hero.x-.15, hero.y, hero.z-.15));
  ne = (collision(hero.x+.15, hero.y, hero.z-.15));
  sw = (collision(hero.x-.15, hero.y, hero.z+.15));
  se = (collision(hero.x+.15, hero.y, hero.z+.15));
  if(
    nw > hero.y + .2 || ne > hero.y + .2 || sw > hero.y + .2 || se > hero.y + .2
  ){
    hero.z = lastz;
  } 
}

// (...)</code></pre>

<p>This problem being out of the way, I can finally start working on my textures!


<p>I generated four 20x20px textures with pxtex and put them in &lt;img> elements at the end of my html page, as well as a &lt;svg> element containing a tree emoji 🌳. It was super easy to tell W.js use these 5 textures in my scene instead of flat colors.
<p>I also had the idea to make the grass, sand and water blocks have slightly different heights, to make the ground look less flat. Since their hit boxes aren't modified, it will give the impression that the hero's feet go deeper in the grass than they do in the sand.

<br><br>
<p><img src=images/js13k24/18.jpg width=900>
<br>
<br>

<p>(As you can see, I tried different textures for the water until I found the one that I liked)

<blockquote class="twitter-tweet" data-theme="dark"><p lang="en" dir="ltr">DAY 5, part 2:<br>Micro texturing time!<br>- Removed the debug spheres.<br>- Stylized my grass/sand/rock pieces with different heights and four 20*20px textures generated with pxtex (featured in GameDevJS newsletter!).<br>- Used &lt;svg&gt;&lt;text&gt;🌳&lt;/text&gt;&lt;/svg&gt; in an img as my tree texture.<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://t.co/UuhvNB1UQh">pic.twitter.com/UuhvNB1UQh</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1824813534305255543?ref_src=twsrc%5Etfw">August 17, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 

<p>I spent the rest of the day making a different level, with more "layers" of cubes, more slopes, and red pyramids (to represent the castle's roofs). By chance, pyramids already existed in 3Dmapeditoe and W.js.
<p>To make things simpler, these pyramids don't have collision boxes at all. You can walk through them.

<p>I also made the jumps smoother and added a basic swimming state (the hero's height gets a bit lower when itts four hit spheres touch water).
 
<p>In the end, the thing that took most of my time that day was the tree. I've been doing js13k entries with emoji since 2017, and every time they cause problems. The main problem being that they don't appear with the same graphics on every OS and browser. Some OS will only show them in black and white, or not at all. Worse even, depending on the OS and browser used, they will have different horizontal and vertical offsets. The same tree could be fine on Windows, buried in the ground on Mac or flying in the air on Android. 

<p>The solution I found in 2018 was to convince <b>@end3r</b> to allow emoji webfonts polyfills for free in the jam's rules. Ever since, I've released many projects aiming to democratize uniformized emoji for js13k entries, the latest being soberly named <a href="https://github.com/xem/unicode13">unicode13</a> (the polyfill itself can be found in the <a href="https://xem.github.io/unicode13/emoji.html">emoji</a> page).

<p>So, I loaded this polyfill in my game and wanted to use it for the tree texture. I couldn't make it work while the tree texture was a svg, so I reused pxtex's canvas to draw a big emoji tree with the right font, on a transparent background, export this canvas as a png image, and use this image as a WebGL texture. That's the tree you can see in the video below.

<blockquote class="twitter-tweet" data-conversation="none" data-theme="dark"><p lang="en" dir="ltr">DAY 5, part 3:<br>- Changed the map<br>- Added pyramids and a roof texture<br>- Added swimming<br>- Replaced svg emoji textures with emoji rendered on a canvas with the Twemoji webfont (for cross-browser consistency)<br>- Trees are bigger<br>- Your feet get lower than the grass surface<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://t.co/ooXSSIuUtd">pic.twitter.com/ooXSSIuUtd</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1824898584585674855?ref_src=twsrc%5Etfw">August 17, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 

<p>Here's my texture atlas so far: five 20x20 pxtex images, and one 200x200px tree emoji. Thanks to them, the scene will look the same for everyone! (the tree doesn't touch the bottom of the image to compensate the grass's extra height.)

<br><br>
<p><img src=images/js13k24/19.png width=500>
<br>
<br>

<hr>
<br>
<p><b>DAY 6</b>

<p>Here's the last public update made on X about this entry: it contains a new map with more trees, doors, fences and a flag.


<blockquote class="twitter-tweet" data-conversation="none" data-theme="dark"><p lang="en" dir="ltr">DAY 6:<br>- Added new elements (fence, flag, doors)<br>- Made trees and hero bigger, compared to the scene<br>- When swimming, movement speed and jump height are lower.<br>- On land, it&#39;s possible to double-jump (the second jump is a bit higher).<br>No more spoilers until release! 👋<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://t.co/ZkYrKsIJC7">pic.twitter.com/ZkYrKsIJC7</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1825159386722914310?ref_src=twsrc%5Etfw">August 18, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 


<p>The doors and flag are generated from the emoji webfont. The fence is drawn on a canvas with "fillrect()" (and enhanced with a horizontal gradient a bit later).
<p>Fences and doors are fixed planes, contrary to the trees and flags that are billboards (always facing the camera).
<p>The left door is the same as the right one, but flipped horizontally. The left door is aligned on the right and the right door to the left, so they can easily be applied as textures over two neighbour blocks.
<p>I also added hitboxes to the fences, but here too, it's very basic. The collision function says that their height is 1 if the decimal part of the Z coordinate is over 0.8, and 0 otherwise.
<p>You can see in the video that the fences don't have back faces: they become invisible when you walk behind them. To fix that, I had to use two planes, one for the front, and one for the back (rotated 180 degrees).

<p>A weird Webkit bug occurred while setting ids for my fence texture image:

<p>HTML: 
<pre class=language-html><code>&lt;img src="..." id=fence></code></pre>

<p>JS:
<pre class=language-js><code>console.log(fence) // null

console.log(window.fence) // null

fence = "test";

console.log(fence) // null</code></pre>

<p>Yup. "fence" is somehow a reserved word in Webkit browsers, you can't use it as a variable. It's always null. It took a lot of head-scratching before figuring this out (I thought the problem came from my texture), but when I finally realized what it really was, I just renamed my fence as "fenc". Suddenly, everything worked fine.

<p>THis is the texture atlas at the end of day 6:
<br><br>
<p><img src=images/js13k24/20.png width=800>
<br>

<hr>
<br>
<p><b>DAYS 7 to 11</b>

<p>The last 5 days of development were not shared publicly. I'm gonna tell you here what happened during that period. I worked on a bunch of things simultaneously, so I'll present them to you in 10 chapters...
</p>
<br>
<hr>
<br><b>1) Speech synth</b>: while I was working on the title screen, I made a few tests of Speech Synth, and started explaining that it was a deep rabbit hole. It became even deeper when I started working on the second screen, where the princess reads the letter. The thing you need to know about the JS Speech Synth API is that the browsers barely have control on it. The only thing browsers do is request the OS to read a given text using a given voice. Many problems can occur at this point:
<br>- Warm-up delay: some browsers (especially Firefox and Android's mobile browsers) can't request the OS's list of voices and return them instantly. <pre class=inline><code class="lang-js">speechSynthesis.getVoices()</code></pre> will return an empty array on the first call, and an actual list if it's called again a few seconds later.
</p>
<br><img src=images/js13k24/21.png width=800>
<br>

<br>- The list of available voices is pretty much unpredictable, as it depends entirely on the OS. The list returned by the API includes names and language codes, but there's no way to know if a voice is male or female. I can only try to predict if a voice is male or female based on its name.
<br>So I asked on js13k's slack for volunteers to execute this line of JavaScript on their setup and show me the results:<br><br><pre class=inline><code class="lang-js">speechSynthesis.getVoices().filter(a=>a.lang.startsWith("en"))</code></pre>.<br><br>I received <a href="images/js13k24/22.png">enough samples</a> to create a list of 21 female and 16 male english voices, which I put in two regexes.

<pre class=language-js><code>// Known male/memale speech synth voices (thanks to people on Slack for giving me their)
female = /Female|Google US English|Susan|Hazel|Zira|Shelley|Grandma|Sandy|Martha|Aria|Priya|Heather|Hayley|Samantha|Catherine|Karen|Tessa|Moira|Kathy|Rishi|Libby/;
male = /Male|George|Rocko|Daniel|Grandpa|Eddy|Reed|Fred|Ralph|Mark|David|Arthur|Guy|Aaron|Albert|Jester/;</code></pre>

<br>When I have a text ro read with a male voice (ex: "It's a me, the great plumber"), I check if any of the available voice matches the male regex. If one does, use it. Else, use the first english voice available by default (even if it's female). The same thing goes for when I need a female voice (ex: "Dear plumber, please come to the castle...") and the female regex.


<br><br><hr><br><p><b>2) The princess' letter</b>: Between the title screen and the introduction, I wanted to reproduce the scene from Mario 64 where princess Peach reads a letter to Mario. I decided to reproduce this scene with HTML, emoji and CSS.

<br><br>
<br><img src=images/js13k24/23.png width=800>
<br>
<br>

<p>The thing is, there's no emoji that represents a side view of a princess. My griend <b>@KorHosik</b> and I looked through all the emoji available, and found the crown emoji (already used in my 2023 entry) and an emoji representing a blonde woman, looking down, in side view, holding/feeding a baby. After some resizing, positioning, rotation and cropping, I think I managed to do something quite resembling!

<br><br>
<br><img src=images/js13k24/24.png width=400>
<br>
<br>

<p>Another thing I needed to do well was the letter's font. There's no system font using pixel-art and I don't want to draw one by hand. Thankfully, the game's font <a href="https://fontmeme.com/fonts/mario-64-font/">is also available in ttf format</a> (and weighs 15kb).

<p>After a bit of trimming with FontForge (and editing the lowercase L that was strangely too much on the left - so much that "click to start" written in this font really looked like "dick to start" - by chance FontForge includes a very nice glyph editor too), I could export a 2.1kb woff2 file containing all the letters I needed for my game.

<br><br>
<br><img src=images/js13k24/25.png width=700>
<br>
<br>

<p>The rest of the letter is basic HTML and CSS. 

<br><br><hr><br><p><b>3) The final map</b>

<p>When I considered my platformer engine good enough, it was finally time to create the actual princess castle...
<p>I started by making sketches on paper, with the help of the amazing <a href="https://noclip.website/#sm64ds/1;ShareData=AMXG/Uke5VTCFLg8GuueV~q[B5eMsKT{?T5UrC4SWsyyxTQs@m92$TbT*67UWPA">noclip.website visualizer</a>, to determine the size of my map, which was initially 28x25 blocks, then reduced to 25x20, when seen from above. 

<br><br>
<br><img src=images/js13k24/26.png width=900>
<br>
<br>

<p>Of course, it's a demake, so a lot of details will be omitted to make it fit in 13kb, and everything will look more flat and cubic than in the original, however I already knew that it could look good because I had already made a (much smaller) 1kb Peach Castle demo for js1k 2019:
<br><br>
<br><img src=images/js1k19/peach1k.gif width=400>
<br>
<br>

<p>Then, I drew my castle with 3Dmapeditor, layer by layer, by leaving every invisible block (inside the castle and below the ground) empty to save space and improve rendering performances. It took me half a day, and iniaially took 21 layers. (Later, after realizing that my slopes collision detection didn't work well on heights higher than 1, I edited it down to 18 layers, reducing the ground's height to a single layer, at water level.

<p>I was surprised to see 3Dmapeditor, made in CSS3D, support very well the creation of such a big map. Below are some work-in-progress screenshots. You can remark that I added basic window 🪟, fence 🚧 and princess 👸 emoji in the editor and that the roofs are in "ice" color instead of red. The roof pyramids are also shown as one little block, but in the final entry, they will be scaled up to cover a larger area (like I had done in JS1K, by the way).

<br><br>
<br><img src=images/js13k24/27.png width=900>
<br>
<br>

<p>After copying the editor's ASCII output into my index.html, feeding it to my 3D platformer's renderer and making dozens of little adjustments manually, it was indeed much more pleasant to look at!

<br><br>
<br><img src=images/js13k24/28.jpg width=500>
<br>
<br>

Oops, that's an off-by-one error.

<br><br>
<br><img src=images/js13k24/29.jpg width=900>
<br>
<br>

Ah, that's a good first draft. Take a look at the water pool blending with the background sea, compared to the original on N64:

<br><br>
<br><img src=images/js13k24/30.jpg width=900>
<br>
<br>

<p>I iterated on the castle's map, textures and overall rendering for 5 days to reach the version that you can see in the final release.   

<br><br><hr><br><p><b>4) The performance issues</b>
<br><br><hr><br><p><b>5) The additional textures and sky</b>
<br><br><hr><br><p><b>6) The intro sequence</b>
<br><br><hr><br><p><b>7) The hero's apparition and interactions</b>
<br><br><hr><br><p><b>8) The audio</b>
<br><br><hr><br><p><b>9) Inside the castle</b>
<br><br><hr><br><p><b>10) The entry's release</b>



<blockquote class="twitter-tweet" data-theme="dark"><p lang="en" dir="ltr">DAY 10 (update):<br>I forgot to run ECT on my zip. I won&#39;t need to golf it finally. It&#39;s already 10 bytes under the 13kb budget with a simple command line.<br>Also, it doesn&#39;t use Roadroller because it needs to do stuff as soon as the page opens, and other things after onload.<a href="https://twitter.com/hashtag/js13k?src=hash&amp;ref_src=twsrc%5Etfw">#js13k</a> <a href="https://t.co/0bj54COoLv">pic.twitter.com/0bj54COoLv</a></p>&mdash; xem 🔵‏ (@MaximeEuziere) <a href="https://twitter.com/MaximeEuziere/status/1826521112882098280?ref_src=twsrc%5Etfw">August 22, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 

<hr>
<br>
<p><b>DAY 10</b>

<!--
Remarks:

Mvasilkov: @xem takes the entire top-10 this year :)

Feedbacks on emojiphobia:

Cody: fun quick game, I feel like I learned something

Feedbacks on Great Plumber 65:

Cody: Very impressive opening sequence. He does flips and yahoos! Looking great! 😍

Joao: pretty amazing :sourire: a bit too much for my poor computer maybe

Remvst: the sound effect when you hit "start" really hurts my ears (...) the rest of the demo is super impressive

Curtastic: The raw emotion in Plumber's voice when he says woohoo is the best part

Herebefrogs: I love it that you still manage to sneak emoji everywhere

bb: Wow, Great Plumber 65 is a work of art... Amazing

https://www.youtube.com/watch?v=HT2HMWjh2ls

https://js13k.bandcamp.com/album/triskaidekaphobia-js13k-2024

https://openclassrooms.com/forum/sujet/image-dans-un-select-10327
-->

</div>


</main>

</div>

<footer></footer>

<script src="../ui.js?v=2024-07"></script>
<script>
header();
footer();
menu();
</script>
<style>
.inline, .inline * { display: inline; padding: 2px !important; }</style>
</body>
</html>