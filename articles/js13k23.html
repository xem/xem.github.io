<!doctype html>
<meta charset=utf-8>
<meta name="viewport" content="width=device-width, user-scalable=no">
<html>
<head>
<link rel=stylesheet href="../style.css?v=2022-10">
<title>Maxime Euzière</title>
<base target=_blank>
</head>
<body>

<style>
.twitter-tweet { margin: 30px 0 !important; border: 3px solid #ccc; border-radius: 30px; overflow: hidden; transform: scale(.95)}
ul { padding-left: 15px }
</style>

<div class="wrapper">

<header></header>

<div id=menu></div>

<main>

<div class=section id=codegolfctober18>

<h2>JS13kGames 2023: CASTLE ESCAPE</h2>
<h3>August-September 2023</h3>
<p><img src="images/js13k23/intro.png">
<br><hr><br>

<h2>The game</h2>
<p>I developed CASTLE ESCAPE
<br><a href="https://js13kgames.com/entries/castle-escape-2023">PLAY IT</a> / <a href="https://github.com/xem/js13k23">see source code on Github</a>
<br>
<br><hr><br>
<h2>The results</h2>
<br>coming soon
<br>
<br><hr><br>
<h2>Making-of</h2>
<br>
<p><b><i>This making-of includes my daily <s>tweets</s> X posts with extra explanations and spoilers.<br>Please try the game first!</i></b>
<br><br>

<p><b>Intro</b>
<p>In 2023, it's been the first year where I competed to JS13k while being unemployed. However, that didn't mean I had more spare time or energy to spend on my entry, as I'm quite busy on other projects, and my eyesight is becoming less and less good with time... So during the first 3 weeks of the jam, I only spent 1-2 hours per day working on my entry (a bit more if you count all the off-screen thinking and brainstorming), and in the last week I put a bit more hours in (4-6 per day) in order to release on time and in the byte budget.
<p>In total it took about 80 hours. Here's how it went...

<br><br><p><b>Day 0 (August 13th)</b>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1691134696665632771?ref_src=twsrc%5Etfw"></a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p><b>13th century</b> is a tough theme indeed! None of the vague ideas I had before starting the jam could fit in that theme or even include a little something about the 13th century. 
<p>So I started from scratch, by looking on Wikipedia what was invented and discovered in that epoch, to make this list:
<p><img src="images/js13k23/1.jpg"><br><br>
<p>You can note that many items of this list have bacome elements of my final game (cannon, clock, paper, astronomy...). Some others were considered for some of my puzzles but didn't get implemented (mirror, soap...).

<p>I scribbled some game ideas at the bottom of the page, the "escape game" is at the very end. I wish I had decided to start with that immediately...
<br><br>

<p><b>Days 1-2</b>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1691553715398820020?ref_src=twsrc%5Etfw"></a></blockquote>

<p>I spent the first two days prototyping and thinking pretty thoroughly a "castles & cannons" game concept where you successively play the role of a king who builds his castle, and his successor who needs to tumble it down with cannon balls. Each king has a successor that is a few dozen meters away, and needs to build his own castle from the bricks he removed from the previous one, while having to build his own castle on a more and more inconvenient ground (slope, hill, mointain, ice, water, etc). The game would end when you run out of bricks.
<p>The only problem is that besides the cannon firing, this was not fun at all, and I had to take the difficult decision to stop and restart from scratch with something else...
<br><br>
<p><b>Days 3-4</b>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1692244621240242619?ref_src=twsrc%5Etfw"></a></blockquote>
<p>The decision to make a castle escape game was taken on day 3... though, once again, I had no idea if I'd be able to release an interesting game on time. But I decided to try my best anyway.
These two days were spent imagining and drawing a 16-room castle on paper and inventing all sorts of puzzles and interactions that could happen in it (in no particular order).
<p>Here are some HD photos:
<p><img src="images/js13k23/2.jpg"><br><br>
<p><img src="images/js13k23/3.jpg"><br><br>
<p><img src="images/js13k23/4.jpg"><br><br>
<p>All the elements and ideas of the final game are here, minus some adjustments (rooms inversions) and some ideas I had to abandon to release on time (using mirrors to reflect light, use seed plus bathroom water plus time machine to grow a plant, use cannon powder, and even a music room where you'd have to play some kind of Simon game to solve a puzzle). Fortunately, I think I made the good decisions, as the puzzles and events present in the final game are quite well balanced and sequenced.
<p>By the way, in order to find some inspiration, I watched gameplays of old, cheap, flash games which are all more or less copy-pasted from each other, such as <a href="https://gamaverse.com/kings-castle-escape-game/">King Castle Escape</a>, <a href="https://gamaverse.com/gold-castle-escape-game/">Gold Castle Escape</a>, <a href="https://gamaverse.com/princess-castle-escape-game/">Princess Castle Escape</a> and <a href="https://gamaverse.com/medieval-castle-escape-game/">Medieval Castle Escape</a>.
You'll find obvious similarities between these games and mine (shields, lock combinations, torches, broken drawbridge...), but I tried to do something as original as possible, even though all castle escape games tend to resemble each other a little, with all these grey bricks, towers, gates, windows, knights, etc... Welp, it is what it is! As long as we have some fun...
<br><br>
<p><b>Days 5-6</b>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1692903723410890810?ref_src=twsrc%5Etfw"></a></blockquote>
<p>Let's start coding, finally! At this moment, my game scenario is far from complete, I still have no idea in which order the puzzles must be solved and the items must be used to beat the game, but it won't stop me from defrosting my <a href="https://xem.github.io/CSS3Dframework/">CSS3D framework</a>, trim all the methods I don't need (actually I just kept "plane" and "move" plus teir dependencies, which take about 1.5kb minified and 0.8 zipped), and start implementing the first room of the game (the top of the left tower).
<p>Here already, 5 different technologies are used to render the scene (I never used so many together before): CSS3D (to make the brick tower cylindric), emoji (door, lock, bed, hole, frame, man and crown in the frame), CSS (for the gradient backgrounds, dynamic brick lighting proportional to their depth, radial-gradient for the sun, plenty of filters to make everything a bit sepia and with a subtle drop-shadow, etc), custom SVGs (for the window, bars, staircase and frame hanger), and Canvas 2D (to draw the sunbeam passing through the window).
<p>The result convinced me, so I prepared the next steps: I built all the room layouts I'll need for my game, out of CSS3D (tower top, tower bottom, first floor under a tower, first floor not under a tower, ground floor... plus walls on the sides for the square rooms on the left or on the right of the building). The hardest part was probably not the one you'd imagine... what took me the most code and brainpower was to draw the half-bricks an quarter-bricks on each side of the rooms.
<p>I showed a snippet of my "brick code" on Slack for fun, and someone had it analyzed by chatGPT, which surprisingly, guessed exactly what were my intentions when I used <b>Math.random()</b> in the  brick's coordinates. It was a fun moment:
<p><img src="images/js13k23/6.png"><br><br>

<p>Another thing harder than it seems was to make holes (windows) inside the tower's wall. After a lot of head-scratching, I finally decided to draw a SVG with a sky blue background <b>#def</b> and render it in front of the wall. Looks exactly like a hole to me, without having to do any complex clipping technique!
<p>The 2D canvas is placed between the background (containing the back wall, window, door, bed, etc) and the foreground (the light bricks), and it really looks like the sunlight comes through the window, when in reality it's all fake.

<p>Note that the whole thing is also much flatter than it appears (here, seen from above...). It seemed quite simpler to give my room a chicken wrap shape instead of a real cylinder (but I may be wrong).
<p><img src="images/js13k23/7.jpg"><br><br>

Finally, I counted the (CSS3D) divs in my scene and it's "only" 179... I've made many games with much more CSS3D complexity than that! But none with so many SVGs and Canvas 2D elements on top. Turns out, browsers seem support that pretty well!

My zip is still smaller than 2.5kb, good news so far! My goal is to have the whole castle fit in under 8kb and use the rest for interactivity, puzzles, animations etc.

<br><br>
<p><b>Days 7-10</b>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1693667920189030426?ref_src=twsrc%5Etfw"></a></blockquote>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1694410018966077654?ref_src=twsrc%5Etfw"></a></blockquote>
<p>Those 4 days were exclusively spent filling and decorating my castle's rooms with emoji, custom svgs and sometimes just colored divs (boulders, chimney, books)...
<p>At the same time, in my mind, the scenario becomes clearer and clearer, so I often return to previous rooms to add or rearrange some items.
<p>I doubt a lot that the result will be fun, but at least it will be playable!
<p>Regarding the emoji: I had the chance to find appropriate emoji for most of my objects (telescope, shield, man, papyrus, wood, cheese, bowl of soup, crown, magic wand, dragon, hammer, chains, skeleton, chef, bat, spider web, mouse, cog, key, etc), but I also had the chance that the emoji webfont I picked (Twemoji.ttf, allowed by js13k's rules because it's a polyfill) contained a ladder that looked very much like a shelf, which allowed me to discard this boring SVG:
<p><img src="images/js13k23/8.jpg"><br><br>
<p>...and the building emoji, that looks a lot like a fireplace when you put a grey rectangle on top and some little fire emoji in front of it:
<p><img src="images/js13k23/10.jpg"><br><br>
<p>On the other hand, I was quite bummed to find that there were no emoji as basic as: a cannon, an anvil, a table, a haystack (or hayball), a knight, a witch, a chest, and big castle doors... so I spent a lot of time (and bytes) drawing them myself, in svg, with my <a href="https://xem.github.io/miniSVGcreator/">MinSVGcreator tool</a>.<br>
<p><img src="images/js13k23/9.jpg"><br><br>
<p>By chance, SVGs are small, text-based and very repetitive, so they zip extremely well: my 28 svgs take 7.7kb minified and about 1.8kb zipped.
<p><img src="images/js13k23/11.jpg"><br><br>

<p><b>Day 11</b>
<p>No code today! (I was occupied renovating my house and inviting friends)

<br><br>
<p><b>Days 12-13</b>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1695435647534747921?ref_src=twsrc%5Etfw"></a></blockquote>

<p>I spent these two days completing and polishing all the rooms of my castle, and implemented the very first interactivity of the game: hover texts.
<p>Every object present on screen (except bricks, ground, ceiling, sky, mountain and light beams) show their name when they are hovered with the mouse on PC. 
<p>I had this idea since day 3, because I thought it would make my entry look more like a LucasArts point&click game, but also because I wanted to impress players by the verbosity of my game, even if it's only 13kb. 
<p>The best part is that it cost me virtually 0 extra bytes, because since the beginning, I gave all my items a CSS className equal to their name in english. So all I had to do (in the source code of the CSS3DFramework) was something like this in the plane creation method: <b>scene.innerHTML+=`&lt;div id="${t.id}"class="${t.css}"onmouseover="writeCaption('${t.css}')">`</b>

<p>Unfortunately, now that my items had hitboxes (for mouse hover, and later, clicks), I realized that their sizes were all wrong, especially the ones containing custom svgs. So I had to go through my 16 finished rooms and fix manually the width, height and thus, the position of absolutely everything, which caused a huge time loss...

<p>The good news is that I'm still very low in size, my zip is even smaller than I had hoped (5.07kb)!

<br><br>
<p><b>Days 14-15</b>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1696236475325575552?ref_src=twsrc%5Etfw"></a></blockquote>

<p>I put myself in front of the computer and didn't quit it until all the hitboxes and positions were fixed, that was extremely boring, but it worked.
<p>Then I could finally start implementing clicks, and started with room transitions! Each open door and staircase has either a "up" button, a "down" button, or both (when in the middle of a tower), while the big square rooms also have left and right arrows, when there's no wall blocking the passage.
<p>It's a real pleasure to finally be able to visit my castle entirely!

<br><br>
<p><b>Days 16-19</b>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1696964164801954188?ref_src=twsrc%5Etfw"></a></blockquote>

<p>I'm officially late! It's the middle of the month and I have zero gameplay yet... and so many things to do!
<p>But first thing first: I started with an inventory system, where we can store items gathered in the castle, then a system allowing to pick an item from the inventory and use it on an element in the room (ex: "use frame hanger on lock"). I also put in place all the architecture allowing special things to happen when objects are taken, dropped or used, and the hardest part: keep the state of each room in memory to be able to see it unchanged when you exit it and re-enter it later. In total, 41 global vars were used to store the game's state!
<p>Unfortunately again, I should have directly put these vars in a single JS object, to make localStorage persistence trivial. The idea of making the game progression saveable and loadable only arrived at the very end of the development and I had to fix each of these variables and the 562 places where they are used in the source code...
<p>To continue with mouse interactivity, I completed the first room of the game (it's playable from start to end, yay), and made the notes on the walls and books in the library readable!
<p>After implementing all the other collectable items, I doubled the inventory space, to 12 slots. There are more than 12 collectibles in the game, but you can never have all of them at once, so it's fine. 

<br><br>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1697699205672776120?ref_src=twsrc%5Etfw"></a></blockquote>

<p>I'm progressibely making all my rooms playable, but also implement "puzzle rooms" (when the scene changes to show a puzzle to solve, such as the sword-in-rock mini-game or the lock combinations).
<p>Even after writing some book of my library, I'm glad to see that the zip size is still not exploding (7.65kb).

<br><br>
<p><b>Days 20-21</b>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1698335155532800471?ref_src=twsrc%5Etfw"></a></blockquote>

<p>Already day 20, time to make a TODO list and see how much work is left... and unfortunately it's a lot: 20 item interactions to implement, as well as 4 animations, 5 puzzles, 2 big svgs, all the music and sound effects, testing, golfing and think of some decentralized bonuses.

<p>The code added on days 20 and 21 added 1kb to the zip (puzzle rooms tend to use a lot of code).

<br><br>
<p><b>Days 22-23</b>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1699107061395534270?ref_src=twsrc%5Etfw"></a></blockquote>

<p>During these two days, I added another kibibyte to my zip with just one feature, certainly the most complex of the game: the witch's time wheel. This one took a lot of time both for brainstorming, and for implementing it.
<p><video controls src="images/js13k23/1.mp4" width=400></video>
<p>Fortunately, with CSS transitions, all the rotations and color changes didn't require a lot of effort. The hardest part was to set and update the right variables when the wheel turns, in order to determine the current day, hour, wheel angle, wheel angle modulo 360, and consequently, the phase of the moon, the haystack-burning setup, and of course, the presence of 0, 1 or 2 prisoners in the right tower if it's not full moon, the presence of the werewolf if it's full moon, and its absence when it's dead.
<p>After letting people test my game, I realized that no one had the idea to get back in time to talk to the second prisoner before he dies, or to get back even further to see the cell empty, even though it's hinted by the dialogs... bummer! But I'm glad I still implemented all  these situations for completion's sake. Also, the second prisoner gives a hint for the end of the game, so it may not be totally useless.
<p><img src="images/js13k23/12.png"><br><br>
<p>There are also little details that are not visible but that I had to think through such as dynamically changing the moon phase emoji at the middle of the day in order to display the right graphics when the night comes (hence the bottom half of the time wheel that is always hidden), or making the sun or moon closer to the rotation point at midday and midnight to have it visible on screen all the time (in the witch room at least); and of course changing the windows svgs backgrounds to dark blue when it's night time.
<br>(I even did it in the window lock puzzle in the middle tower, even though almost no one will ever see it)
<p><img src="images/js13k23/13.png"><br><br>
<p>The only thing I didn't bother to implement was causality (i.e. when you solve a puzle then go back in time, it stays solved). It's more convenient like that for the players and for me.

<br><br>
<p><b>Day 24</b>
<blockquote class="twitter-tweet" ><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1699521678907256990?ref_src=twsrc%5Etfw"></a></blockquote>
<p>On day 24, I still had no precise idea of how the puzzles and actions would depend on each other, so I decided to make a diagram / dependency chart (inspired by <a href="https://grumpygamer.com/rtmi_pdc">those made by Ron Gilbert</a> for his point&click games):
<p><img src="images/js13k23/5.jpg"><br><br>
<p>And it was pretty useful: it made me realize there was a major plot hole (I made the second prisoner give a hint on how to find the magic wand, which is normally used to find this prisoner in the first place... to fix it, I gave this line of dialog to the witch and had the prisoner give a hint about the broken drawbridge mechanism).
<p>At the end of the day, I would have been almost at 13kb if RoadRoller (which brings my zip down to exactly 10kb) didn't exist!

<br><br>
<p><b>Days 25-26</b>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1700232496305061951?ref_src=twsrc%5Etfw"></a></blockquote>
<p>On days 25 and 26 I did a big effort to implement 100% of the gameplay, room by room, which would leave me about 5 days for testing, polishing, sound, music and golfing (even though I still have a comfortable margin, with my 11.6kb zip).
<p>It's been quite hard to draw the "outside view" from the castle's gates: there's the same issue as I have had earlier for the windows: I had to draw a SVG representing a hole on the wall, a floor, a closed drawbridge and mountains in the background, which wasn't trivial for my SVG skills.
<p>I spent a lot of time implementing FOUR different animations for the cannon, corresponding to every possible scenario where it's fired (without wood, with wood but without unlocking the window in the second tower, with wood and open window but without the wolf, and finally, with the wolf). The hardest part in these animations was to give the impression that the cannonball was passing through the window, when in fact it was traversing an opaque window svg placed in front of the brick wall... fortunately, with some fine-tuning and enough speed, it looks fine.
<p>I finished with the end cinematic, where the drawbridge finally opens, created from scratch with 5 CSS3D divs (one for the floor, one for the bridge, two for the bridge supports, and one for the mountains. Quite simple, but I think it's convincing!

<br><br>
<p><b>Days 27-28</b>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1700918187292832058?ref_src=twsrc%5Etfw"></a></blockquote>
<p>As I wrote on Twitter (X), those two days were spent beta-testing my game with 3 friends and fixing absolutely everything that wasn't perfect (bugs, graphics, browser compatibility (ughh, Firefox didn't like scaled up 99x99px SVGs so I had to rewrite most of them 10x bigger and scale them *down* to avoid having them all blurry), saving and loading, hover cursors, etc), which resulted in a huge Github changeset containing in total 1030 edits (impacting almost half of my source code).
<p>So it's been very busy, but the good thing is that the game is finally playable from start to end !
<p>A little (important) detail was also added at this moment: fade-in and fade-out transitions between rooms. This allowed to hide the fact that a room takes 0.25s to 0.5s to load entirely. Without the black transition, every click on an arrow button seemed to lag, which was pretty incomfortable. Now it's cool.
<p>You know how I'm bad at composing music... By chance, on day 27, <b>Ryan Malm</b> (co-winner of js13k 2017 with me) proposed his help to compose a theme for anyone interested, and I jumped on the occasion.
<p>He asked me what tool I wanted him to use, and we picked <a href="https://xem.github.io/miniOrchestra/">MiniOrchestra</a>, a tool I created a few years ago but which is far from perfect (it sometimes creates corrupted outputs and doesn't let users move notes or listen to a song in a loop easily).
<p>Nonetheless, on the span of a couple days, he managed to compose a theme that (I think) matches perfectly the ambiance of my game. It's a 26-second loop that I can listen repeatedly without ever getting tired of, so congrats and thank you a thousand times, Ryan!
<p>To continue on the audio side, I unearthed my beloved micro sound effects library <a href="https://xem.github.io/MiniSoundEditor/">MiniSoundEditor</a> (created by <b>Anders Kaare</b> and golfed by me in 2016, and realized that the available sound effects didn't really cover my needs. I know I'm terrible at composing sound effects with code, but for once, I tried: I took existing sounds and changed their lengths, volumes, and other coefficients in order to create new sounds (12 in total). It's 100% rocket science and trial & error, but I'm pretty happy with the result, especially for the bridge one and the cannon fire one!

<p><b>DEMO: sounds created for this game</b>

<p><button id=p hidden>play</button>
<textarea rows=20 cols=60 id=code hidden></textarea>
<canvas id=canvas width=600 hidden></canvas>
<div id=d></div>



<script>

x = canvas.getContext("2d");


golf = `

// Sound player
t=(i,n)=>(n-i)/n;
A=new AudioContext()
m=A.createBuffer(1,96e3,48e3)
b=m.getChannelData(0)
for(i=96e3;i--;)b[i]=f(i)
s=A.createBufferSource()
s.buffer=m
s.connect(A.destination)
s.start()`;

p.onclick = function(){
  eval(code.value);
  draw();
}

onload = function(){
  ex(1, 0);
}

examples = [

[
"nudge",
`f = function(i){
  var n=6e3;
  if (i > n) return null;
  var q = t(i,n);
  return Math.sin(i*0.01*Math.sin(0.009*i+Math.sin(i/200))+Math.sin(i/100))*q*q;
}`
],

[
"lock",
`f = function(i){
  var n=8e3;
  if (i > n) return null;
  return ((Math.pow(Math.pow(i,0.9)+Math.sin(i*1.06)*1000,0.8)&200)?0.5:-0.5)*Math.pow(t(i,n),1);
}`
],

[
"paper",
`f = function(i){
  var n=2e4-9000;
  if (i > n) return null;
  var q = t(i+10000,n);
  return Math.sin(-i*0.03*Math.sin(0.09*i+Math.sin(i/200))+Math.sin(i/100))*q;
}`
],

[
"burn",
`f = function(i){
  var n=30e4;
  if (i > n) return null;
  var q = t(i,n);
  return Math.sin(-i*0.03*Math.sin(0.09*i+Math.sin(i/200))+Math.sin(i/100))/q/(i>5e4?i/8e3:5);
}`
],

[
"miniburn",
`f = function(i){
  var n=5e4;
  if (i > n) return null;
  var q = t(i,n);
  return Math.sin(-i*0.03*Math.sin(0.09*i+Math.sin(i/200))+Math.sin(i/100))/q/(i>5e4?i/8e3:5);
}`
],

[
"wand",
`f = function(i){
  var n=5e4;
  var n1=1e5;
  if (i > n) return null;
  i=Math.pow(i,1.2-Math.sin(i*2/n1))*6;
  var x=Math.sin(i/30+Math.sin(i/1500));
  return Math.pow(x,9)*t(i,n);
}`
],

[
"sword",
`f = function(i){
  var n=15e3;
  if (i > n) return null;
  var q = t(i,n);
  return Math.sin(i*0.001*Math.sin(0.009*i+Math.sin(i/200))+Math.sin(i/100))*q*q;
}`
],

[
"downbridge",
`f = function(i){
  var n=60e4;
  if (i > n) return null;
  return ((Math.pow(i+Math.sin(i*0.001)*1000,0.8)&200)?0.5:-0.5)*Math.pow(t(i,n),1);
}`
],

[
"cannonfire",
`f = function(i){
  var n=4e4;
  if (i > n) return null;
  return Math.sin(i/200 - Math.sin(i/331)*Math.sin(i/61) + Math.sin(Math.sin(i/59)/39) * 33)*t(i,n)*9;
}`
],

[
"fiou",
`f = function(i){
  var n=5e4;
  if (i > n) return null;
  var q = t(i,n);
  i=i*0.7;
  return (Math.pow(i*50,0.8)&34)?q:-q;
}`
],

[
"dooropen",
`f = function(i){
  var n=3e4;
  if (i > n) return null;
  var q = t(i,n);
  return Math.sin(i*0.001*Math.sin(0.009*i+Math.sin(i/200))+Math.sin(i/100))*q*q;
}`
],

[
"step",
`f=(s,r,e)=>(3800,s>3800?null:(e=t(s,3800),Math.sin(.01*s*Math.sin(.001*s+Math.sin(s/200))+Math.sin(s/200))*e*e/9))`
]
];

for(e in examples){
  d.innerHTML += "<button onclick=ex("+e+")>"+examples[e][0];
}

ex = function(e, play=1){
  code.value = "// Sound\n" + examples[e][1] + golf;
  if(play){
    p.click();
  }
}

draw = function() {
  canvas.width ^= 0;
  x.moveTo(0, 75);
  for(i=96e3;i--;) x.lineTo(i/100, f(i) * 65 + 75);
  x.stroke();
}
</script>

<br><br>
<p><b>Days 29-30</b>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1701290254328627450?ref_src=twsrc%5Etfw"></a></blockquote>

<blockquote class="twitter-tweet" data-conversation="none"><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1701477506916724813?ref_src=twsrc%5Etfw"></a></blockquote>

<p>48 hours left! I spent this day adding a simple title screen (with a nice 3D effect though), fixing even more bugs, and since I had some spare bytes, I allowed Ryan to add a few notes to his song, to make the theme that you can hear in the final game. In total he composed for 3 instruments played in parallel. The song takes about 2.4kb minified, and for the first time, my zip is now over the 13kb budget (13.3kb)... which means I finally get the chance to golf my code a little!
<p><img src="images/js13k23/14.jpg"><br><br>
<p>I did a quick test by manually mangling my longest ids var names, function names and CSS classes (except the ones used for mouseover, of course) to 1 or 2 characters, and it was enough to reach 13.1kb... but every extra step of mangling that I tried to add made RoadRoller and Zip less efficient and added bytes instead of removing them.
<p>So I reverted all that, went to bed and decided to tackle that more seriously the next day... 

<br><br>
<p><b>Day 31</b>
<blockquote class="twitter-tweet" ><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1701579195308969999?ref_src=twsrc%5Etfw"></a></blockquote>
<blockquote class="twitter-tweet" data-conversation="none"><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1701696857833976289?ref_src=twsrc%5Etfw"></a></blockquote>

<p>For the first time since day 5, I gathered all my code in a single index.html file (2232 lines of code, 79.8kb), read it, and I found a ton of little optimizations and factorizations that could amply simplify it. Without even using RoadRoller nor mangling, these edits were enough to remove nearly 0.3kb to my minified + zipped source code.
<p>To that, I added the manual mangling attempted the day before (at least the efficient one), and after a strong RoadRoller pass, got a 13288b zip (under the 13312b limit)!
<p>I played the entire game entirely one last time to fix a couple final bugs (mostly name collisions caused by a too greedy mangling), and my zip finally reached 13312b, exactly 13kb! I took it as a sign and wrapped it up for release, about 15 hours before deadline!
<p>I wouldn't have made it on time (or a little early) without the invaluable contribution from <b>Ryan Malm</b> (I love that song), the help of my beta-testers <b>Adrien, Sam, Damien, Julien & Anouk</b> and the magnificent, revolutionary, incredible tool <a href="https://lifthrasiir.github.io/roadroller/">RoadRoller</a> by <b>Kang Seonghoon</b>, without whom my game would have been 3.2kb too big (!!!) and would have suffered from very dramatic feature cuts and a much lower overall quality.
<p>The "clickbait" thumbnail was generated by an AI and edited with Paint (to change a little from my usual screenshot thumbnails)... I think it's quite convincing, too.

<p><b>Day 32 (September 13th)</b>
<blockquote class="twitter-tweet" data-conversation="none"><p lang="en" dir="ltr"><a href="https://twitter.com/MaximeEuziere/status/1701852726924075216?ref_src=twsrc%5Etfw"></a></blockquote>
<p>On the morning of the last day (october 13), I only had one thing left to do: the Web3 bonuses.
<p>First, I uploaded the game on IPFS via <a href="https://app.pinata.cloud">Pinata</a> (unfortunately, the free plan doesn't allow HTML hosting, so I sent the 13kb zip).
<p>Then I made a leaderboards system and allowed people to submit their best times and lowest number of clicks after they complete their adventure. The leaderboards is hosted on IPFS bt the update is still done manually by me when someone tweets (posts) their score on Twitter (X)... I didn't have the time to implement something smarter.

<p>Some people began to play my game and seem to like it a lot... they find fun bugs that I had never seen before (infinite soup, infinite mice, infinite sword...), so I made the fixes and sent an update to King Andrzej.
<p><img src="images/js13k23/16.jpg"><br><br>
<p>There's another bug that happens after tou kill the werewolf: if you use the time wheel to go in the future, the prisoner is still alive. I forgot to check the wolf's death when drawing the non-full-moon variant of the jail...
<p>Wall... Now I know how hard it is to make a flawless point&click game.
<p>Another surprising remark from many testers is that they saw the "KONAMI" initials easte-egg rightaway, but didn't read the text in the book "How Arthur Became King" until I told them that the text actually explained how to do the Konami code. They they re-read it and found it very smart... Welp, ok.


<br><br><hr><br>

<p><h2>After the jam</h2>
<p>I spent two days writing the current making-of and the following two weeks testing and voting for the other entries!
<p>The results are... (coming soon)

<br><br><hr><br>

<p><h2>Feedbacks</h2>
<p>(coming soon too)

<br><br><hr><br>
<p>See you next year!
<p>Cheers,
<p>xem
<p>
<br>
<br>



</div>


</main>

</div>

<footer></footer>

<script src="../ui.js?v=2022-10"></script>
<script>
header();
footer();
menu();
</script>

</body>
</html>