<!doctype html>
<meta charset=utf-8>
<html>
<head>
<link rel=stylesheet href="../style.css?v=4">
<title>Maxime Euzière</title>
</head>
<body>

<div class="wrapper">

<header></header>

<div id=menu></div>

<main>

<div class=section id=js1k2015>
  <h2>JS1k 2015</h2>
  <h3>february 2015</h3>
  <p>This month was very busy! I spent almost all my free time <s>working</s> golfing for JS1k.</p>
  <br>
  <p>➾ I contributed to <a href="http://subzey.github.io/js1k2015invitro/" target=_blank>the great invitro</a> made by @subzey, by finding a brand new compression technique, allowing to hash the canvas properties as well as the canvas functions.
  <br>You can read more about it in <a href="https://github.com/subzey/js1k2015/tree/master/postmortem" target=_blank>his post mortem</a> and the discussion in <a href="https://github.com/Siorki/RegPack/issues/21" target=_blank>this RegPack ticket</a>.
  <br>It was very exciting to discover this new technique and save about 50 bytes on a demo we thought we couldn't compress anymore!</p>
  <br>
  <img src="images/js1k15-1.png" width=200>
  <br>
  <br>
  <hr>
  <br>
  <p>➾ I gathered the best code-golfed games and apps made during the past months by "the codegolf team" into three compilations:
  <br><br>- <a href="http://js1k.com/2015-hypetrain/demo/2121" target=_blank>Mini Apps Collection</a><br>Featuring 7 apps! Mini Code Editor, HTML & CSS minifier, hex viewer, dataURI converter, spritesheet and JSPerf.<br>(1477b minified, 1024b regpacked)
  <br><br>- <a href="http://js1k.com/2015-hypetrain/demo/2100" target=_blank>Mini Games Collection #1</a><br>Mine Sweeper, Pop Tiles, and Game of Life.<br>(1221b minified, 1023b regpacked)
  <br><br>- <a href="http://js1k.com/2015-hypetrain/demo/2145" target=_blank>Mini Games Collection #2</a><br>Simon with sound and 2048.<br>(1220b minified, 1022b regpacked)
  <br><br>It took a lot of time to fit each of these compilations in 1k, which involved removing some features not compatible with js1k's rules (like accessing "top" and localStorage"), managing to inject big chunks of HTML and JS into the shim with many "document.write", "innerHTML" and "outerHTML"-based hacks, and optimizing the whole code for a better RegPack compression (by repeating code as much as possible, sometimes in very silly ways)...
  <br><br>Thanks to @p01, @subzey, @aemkei, @LauckAndLoad, @bburky, @mathias and @veubeke for their contribution in each of these projects!
  <br>You can read more about these apps and games (and their original projects) by clicking the "demo details" button on each demo.
  </p>
  <br>
  <br>
  <img src="images/js1k15-2.png" width=700>
  <br>
  <br>
  <hr>
  <br>
  <p>➾The theme was "Hype Train", so I couldn't resist making <a href="http://js1k.com/2015-hypetrain/demo/2160" target=_blank>this little hommage</a> to asdfmovie's sequence <a href="https://www.youtube.com/watch?v=5DjOL2we8ko" target=_blank>I like trains</a>. The code has nothing special, just a lot of points coordinates and a loop displaying them with moveTo and lineTo's. This kind of "monotonous" source code packs very well (1472b minified - 902b regpacked)
  <br>
  <br>
  <img src="images/js1k15-3.png"></p>
  <br>
  <hr>
  <br>
  <p>➾ The biggest challenge was of course my "serious" entry, <a href="http://js1k.com/2015-hypetrain/demo/2316" target=_blank>hypeRcube</a>!</p>
  <p>With all the success of the 3D demos during the past years, my idea was to produce the first 4D demo of JS1k, featuring an "hypercube" (the 4D equivalent of a 3D cube). I had no precise idea of what I would (or could) do in 1k, but I aimed for some kind of animated / rotating hypercube, like the ones we can see on <a href="http://en.wikipedia.org/wiki/Tesseract" target=_blank>wikipedia's gifs</a>.</p>
  <p>It took more than 10 iterations (10 more or less big rewrites) to become what it is today, and each of these rewrites was marked by a new exciting feature, a compression breakthrough, or a funny bug that made me understand that I was not on the good path. You can tke a look at these beta versions here:</p>
  <p>&bull; <a href="demos/hypercube/0.html">Proof of concept</a>, very laggy but featuring an intro, perspective, camera rotation and the 6 4D rotations (3.1kb minified, and only 1.3kb regpacked, due to heavy code reuse). This PoC convinced me that doing a 4D demo for js1k was possible! (<a href="https://twitter.com/MaximeEuziere/status/566610056540852225" target=_blank>tweet</a>)
  <p>&bull; <a href="demos/hypercube/1.html">Beta #1</a>, with more reactive buttons, and intensive golfing (2.0kb minified, 1.1kb regpacked) 
  <p>&bull; <a href="demos/hypercube/2.html">Beta #2</a>, almost fitting in 1k (1.9kb minified, 1037b regpacked)
  <p>&bull; <a href="demos/hypercube/3.html">Beta #3</a>, golfed intensively (1.6kb minified, 963b regpacked). From this point I knew that I would be able to add many more features and graphical enhancements in my 1kb demo!<br>Actually, I added features and golfed them at the same time to stay as close as possible to 1kb.
  <p>&bull; <a href="demos/hypercube/4.html">Beta #4</a>, adding colors, and allowing to play/pause animations... but it's so slow ! (1.5B minified, 1022b regpacked) - <a href="https://twitter.com/MaximeEuziere/status/566615949009498113" target=_blank>funny</a>... <a href="https://twitter.com/MaximeEuziere/status/566629132935901184" target=_blank>bugs</a>.
  <p>&bull; <a href="demos/hypercube/5.html">Beta #5</a>, enhancing speed and adding a perspective slider going from an isometric view (2.5D) to an exaggerated 3D view... (1.5kb minified, 1030b regpacked)
  <p>&bull; <a href="demos/hypercube/6.html">Beta #6</a>, adding two color pickers and optimizing the workflow for RegPack (reusing the vars produced by RegPack and putting all the code in a string that will execute itself repeatedly using a timeout (1.58kb minified, 1042b regpacked) - the main achievement here was to achieve drawing the hypercube in a single pass, using only connected edges and not passing more than one time by the same edge, thanks to <a href="images/js1k15-4.png" target=_blank>this <s>wonderful</s> crazy path</a> I've drawn on paint (other funny <a href="https://twitter.com/MaximeEuziere/status/566947180267982849" target=_blank>bug</a>)
  <p>&bull; <a href="demos/hypercube/7.html">Beta #7</a>, YAY EPILEPTIC PARTY! very buggy but I find it artistic. (see <a href="https://twitter.com/MaximeEuziere/status/567068576239345665" target=_blank>gif</a>)
  <p>&bull; <a href="demos/hypercube/8.html">Beta #8</a>, stabilized and golfed a bit more (1.56kb minified, 974b regpacked)
  <p>&bull; <a href="demos/hypercube/9.html">Beta #9</a>, I tried to fill the hypercube in red but it was a bad idea. (<a href="https://twitter.com/MaximeEuziere/status/569130388939010049" target=_blank>related tweet</a>)
  <p>&bull; <a href="demos/hypercube/10.html">Beta #10</a> finished, with an extra feature to slow down or speed up the animation (1.57kb minified, 1021b regpacked)
  <p>Making this demo helped me understand better the 4th dimension, and even if I only scratched the surface, I find it amazing. I was surprised to see so many features and graphic effects fit in 1kb, thanks to many epic golfing tricks, but also hand-made line-drawing (see demo #6), as well as dirty hacks to optimize the code for RegPack (repeating big chunks as much as possible to reduce entropy), and faking the perspective effect by just drawing lines on a canvas and making the points closer to each other to give the impression that they are further from the camera...</p>
  <p>To achieve so many things, the secret holds in two words: passion and organization. If you want to see how organized it is, you can read the source code below. I detailed it as much as I could to make it useful for anyone wanting to discover the tricks used inside.
  <p>Thanks for your attention and see you next year!
  <br>
  <br>
  <img src="images/js1k15-5.png">
  <br>
  <br>
  </p>
  <hr>
  <br>
  <p><h3>Source code</h3>
  <p><b>Commented (5735b)</b>
  <br>
  <button onclick=commentedhypercube.style.display='block';this.style.display='none'>Show</button>
  <pre id=commentedhypercube style=display:none><code class="lang-js">// Golf & build process
// ====================

// The content of the following loop function above is:
// * golfed
// * minified with Closure Compiler
// * cleaned (bacause CC leaves unnecessary spaces)
// * RegPacked (NB: in RegPack settings, add "a b c _ X Y Z" to the list of unrenamable vars)
// and the result is submitted to js1k


// What happens in this demo
// =========================
// - When the demo loads, Regpack generates and evals a string: _.
// - It also leaves the variable g to null
// - When _ is eval'ed, it draws the current frame and sets a timeout to re-eval itself, and so on
      

// Variables
// =========

// a: canvas
// b: body
// c: canvas context2d
// d: which animation (0: none, 1: X, 2: Y, 3: Z)
// e: animation direction (1 = forward, 3 = backward)
// f: array containing the coordinates of all the points of the tesseract (to read 3 by 3). They are arranged to form a hamiltonian path where all edges are used only once (see http://img.ctrlv.in/img/15/02/14/54dfca5f4c396.png)
// g: null at the beginning, then truthy while the demo plays
// h: rotation state (0: pause, 1: play)
// i: iterator
// j: lines color's input
// k: perspective (-10 to 10: 2.5d do exaggerated 3D)
// l: mouse X
// m: mouse Y
// n: demo state (0: pause, 1: play)
// o: demo frame counter
// p: rotation frame counter
// q: number of frames in an animation loop
// r: unused
// s: unused
// t: temp var
// u: X coordinate of each point projected on a cube (0 => 1, 1 => 1, 2 => 2, 3 => 2)
// v: Y coordinate of each point projected on a cube
// w: Z coordinate of each point projected on a cube
// x: X coordinate of each point in the tesseract
// y: Y coordinate of each point in the tesseract
// z: Z coordinate of each point in the tesseract


// This simulates the state of _ and g after unpacking.
_ = "";
g = null;

loop = function(){

// ==============
// RegPacked code
// ==============

// Initializations (only at the first frame, when g is null)
// ---------------

if(!g){

  // Variables
  d =
  e =
  h = 
  k = 
  o = 
  n =
  p = 
  l =
  m = 0;
  
  // Body background
  b.style.background = "#112233";

  // Points coordinates (full version: [[0,0,0],[3,0,0],[3,3,0],[2,2,1],[2,1,1],[3,0,0],[3,0,3],[2,1,2],[2,2,2],[1,2,2],[1,2,1],[1,1,1],[2,1,1],[2,1,2],[1,1,2],[1,1,1],[0,0,0],[0,0,3],[1,1,2],[1,2,2],[0,3,3],[3,3,3],[3,0,3],[0,0,3],[0,3,3],[0,3,0],[3,3,0],[3,3,3],[2,2,2],[2,2,1],[1,2,1],[0,3,0],[0,0,0]] )
  g = f = "030000300330221211300303212222122121111211212112111000003112122033333303003033030330333222221121030000".split("");
  
  // Inputs & buttons
  document.write("&lt;center>&lt;input type=range style=width:6em oninput=k=value/5-9>&lt;input type=color value=#112233 oninput=b.style.background=value>&lt;input type=color value=#ffffff id=j>&lt;p>&lt;button onclick=p=1==d?q-p:q;h=1;d=1;e=1>X&lt;button onclick=p=1==d?q-p:q;h=1;d=1;e=3>-X&lt;button onclick=p=2==d?q-p:q;h=1;d=2;e=1>Y&lt;button onclick=p=2==d?q-p:q;h=1;d=2;e=3>-Y&lt;button onclick=p=3==d?q-p:q;h=1;d=3;e=1>Z&lt;button onclick=p=3==d?q-p:q;h=1;d=3;e=3>-Z&lt;/button>&lt;p>&lt;button onclick=h=1-h>pause&lt;button onclick=if(q&lt;2048)p*=2,q*=2>slow&lt;button onclick=if(4&lt;q)p/=2,q/=2>fast");
  
  q = 256;
  
  // When mouse moves
  onmousemove = function(e){
    
    // Get X
    l = (a.width - e.pageX * 2) / 50;
    
    // Get Y
    m = (350 - e.pageY * 2) / 30;
    
    // Start animation
    n = 1;
  };
}

// Main loop
// =========

// If demo has started, increment frame counter
if(n){
  o++;
}

// If current animation is not in pause, play it. Reset it when it's finished (to loop)
if(h){
  p = (p + q - 1) % q;
}

// Flush canvas (doesn't work on IE T_T )
a.width += 0;


// Loop on all the points
for(i = f.length; i-=3;){

  // Get its "real" position (in the tesseract)
  x = +f[i];
  y = +f[i+1];
  z = +f[i+2];
  
  // Get its projected position on a cube
  u = x &lt; 2 ? 1 : 2;
  v = y &lt; 2 ? 1 : 2;
  w = z &lt; 2 ? 1 : 2;
  
  
  // During the first 170 frames, animate from 0d (point) to 1d (line) to 2D (square) to 3D (cube) to 4d (tesseract)
  if(o &lt; 170){
  
    x = (
      o &lt; 30                                // if o &lt; 30
      ? 1.5 + (i &lt; 30 ? .01 : 0)            // x = 1.5 + a little X delta to show the initial dot on non-Firefox browsers (T_T)
      : o &lt; 50                              // else if o &lt; 50
        ? 1.5 + (u - 1.5) * (o - 30) / 20   // x = a value between 1.5 and the closest position from the center
        : o &lt; 150                           // else if o &lt; 170
          ? u                               // x = the closest position
          : u + (x - u) * (o - 150) / 20    // x = a value between the closest position and the final position
    );
    
    y = (
      o &lt; 70                                // if o &lt; 70
      ? 1.5                                 // y = 1.5
      : o &lt; 90                              // else if o &lt; 90
        ? 1.5 + (v - 1.5) * (o - 70) / 20   // y = a value between 1.5 and the closest position from the center
        : o &lt; 150                           // else if o &lt; 170
          ? v                               // y = the closest position
          : v + (y - v) * (o - 150) / 20    // y = a value between the closest position and the final position
    );
    
    z = (
      o &lt; 110                               // if o &lt; 110
      ? 1.5                                 // z = 1.5
      : o &lt; 130                             // else if o &lt; 130
        ? 1.5 + (w - 1.5) * (o - 110) / 20  // z = a value between 1.5 and the closest position from the center
        : o &lt; 150                           // else if o &lt; 170
          ? w                               // z = the closest position
          : w + (z - w) * (o - 150) / 20    // z = a value between the closest position and the final position
    );
  }
  
  // After the introduction, when the buttons are clicked, 4D animations are performed
  else {
    
    // X / Y / Z animations
    t = ([x,x,y,z][d] + e) % 4;
    u = x &lt; 2 ? [0,1,1,0][t] : 3 - [0,1,1,0][t];
    v = y &lt; 2 ? [0,1,1,0][t] : 3 - [0,1,1,0][t];
    w = z &lt; 2 ? [0,1,1,0][t] : 3 - [0,1,1,0][t];
    
    if(d == 1){
      u = t;
    }
    
    if(d == 2){
      v = t;
    }
    
    if(d == 3){
      w = t;
    }
    
    // x,y,z in-between
    x = x + (u - x) * p / q;
    y = y + (v - y) * p / q;
    z = z + (w - z) * p / q;
  }
  
  c.lineTo(
    a.width / 2 - 100 + x * 60 - (x - 1.5) * (z - 1.5) * (k + 9) + l * (z - 1.5),
    80 + y * 60 - (y - 1.5) * (z - 1.5) * (k + 9) + m * (z - 1.5)
  );
}

// Decrease line width progressively from 35 to 2.
c.lineWidth = o &lt; 99 ? 35 - o / 3 : 2;

// Set lines style
c.lineCap = c.lineJoin = "round";
c.strokeStyle = j.value;

// Draw the lines
c.stroke();

// Draw the next frame in 30ms.
setTimeout(_,30);

// =====================
// End of RegPacked code
// =====================

};

// This simulates the timeout inside the packed code
loop();
setInterval(loop, 30);</code></pre>
  <p><b>Minified (1550b)</b>
  <br>
  <button onclick=minifiedhypercube.style.display='block';this.style.display='none'>Show</button>
  <pre id=minifiedhypercube style=display:none><code class="lang-js">g||(d=e=h=k=o=n=p=l=m=0,b.style.background="#112233",g=f="030000300330221211300303212222122121111211212112111000003112122033333303003033030330333222221121030000".split(""),document.write("&lt;center>&lt;input type=range style=width:6em oninput=k=value/5-9>&lt;input type=color value=#112233 oninput=b.style.background=value>&lt;input type=color value=#ffffff id=C>&lt;p>&lt;button onclick=p=1==d?J-p:J;h=1;d=1;e=1>X&lt;button onclick=p=1==d?J-p:J;h=1;d=1;e=3>-X&lt;button onclick=p=2==d?J-p:J;h=1;d=2;e=1>Y&lt;button onclick=p=2==d?J-p:J;h=1;d=2;e=3>-Y&lt;button onclick=p=3==d?J-p:J;h=1;d=3;e=1>Z&lt;button onclick=p=3==d?J-p:J;h=1;d=3;e=3>-Z&lt;/button>&lt;p>&lt;button onclick=h=1-h>pause&lt;button onclick=if(J&lt;2048)p*=2,J*=2>slow&lt;button onclick=if(4&lt;J)p/=2,J/=2>fast"),J=256,onmousemove=function(r){l=(a.width-2*r.pageX)/50;m=(350-2*r.pageY)/30;n=1});n&&o++;h&&(p=(p+J-1)%J);a.width+=0;for(i=f.length;i-=3;)S=+f[i],y=+f[i+1],T=+f[i+2],u=2>S?1:2,v=2>y?1:2,w=2>T?1:2,170>o?(S=30>o?1.5+(30>i?.01:0):50>o?1.5+(u-1.5)*(o-30)/20:150>o?u:u+(S-u)*(o-150)/20,y=70>o?1.5:90>o?1.5+(v-1.5)*(o-70)/20:150>o?v:v+(y-v)*(o-150)/20,T=110>o?1.5:130>o?1.5+(w-1.5)*(o-110)/20:150>o?w:w+(T-w)*(o-150)/20):(t=([S,S,y,T][d]+e)%4,u=2>S?[0,1,1,0][t]:3-[0,1,1,0][t],v=2>y?[0,1,1,0][t]:3-[0,1,1,0][t],w=2>T?[0,1,1,0][t]:3-[0,1,1,0][t],1==d&&(u=t),2==d&&(v=t),3==d&&(w=t),S+=(u-S)*p/J,y+=(v-y)*p/J,T+=(w-T)*p/J),c.lineTo(a.width/2-100+60*S-(S-1.5)*(T-1.5)*(k+9)+l*(T-1.5),80+60*y-(y-1.5)*(T-1.5)*(k+9)+m*(T-1.5));c.lineWidth=99>o?35-o/3:2;c.lineCap=c.lineJoin="round";c.strokeStyle=C.value;c.stroke();setTimeout(_,30)</code></pre>
  <p><b>Packed (1024b)</b>
  <br>
  <button onclick=packedhypercube.style.display='block';this.style.display='none'>Show</button>
  <pre id=packedhypercube style=display:none><code class="lang-js">for(_='on~e=R-1.5)QQ*(PPo-O30N0N000M0+60*L0)/20KinputIroundHbutt~G11F=(E0>o?DD1.5BB+(A212@=t),idthtylePTPk+9)+)*p/J?1:2,=+f[i;R1>;c.stroke-2*r.page ~I=&lt;G ~click=p===d&&(;R3>-33[0,1,1,0][t]F2valuea.w>&lt;I typR	=2>c.lineb.s.backgH=)*(o-15KK:15D	color =#?:3-,==d?J-p:J;h=1;d=g||(d=Rh=k=o=n=p=l=m=0,"#2",g=f="MN002@FN0N3@22@@F12F100000312200N0N0N03222221M".split(""),document.write("&lt;center	range s=w:6emk=/5-92ffffff id=C>&lt;p>11X11X22Y22Y33Z33Z&lt;/G>&lt;p>h=1-h>pauseif(J&lt;2048)p*=2,J*slowif(4&lt;J)p/=2,J/fast"),J=256,~mousemovRfuncti~(r){lEX)/50;mE350Y)/N;n=1});n&&o++;h&&(pEp+J-1)%J);+=0;for(i=f.length;i-=3;)S],y+1],T+2],uSvywT17D(S=3AN>i?.01:0):5AuO3u:u+(S-u,y=7B:9AvO7v:v+(y-v,T=FB:13AwOFw:w+(T-w):(tE[S,S,y,T][d]+e)%4,uSvywT1u2v3wS+Eu-S,y+Ev-y,T+Ew-T),To(/2-10LS-(Sl*(TQ,8Ly-(ym*(TQ);W=99>o?35-o/3:2;Cap=Join="H"S=C.();setTimeout(_,N)';g=/[^ -?CJS-}]/.exec(_);)with(_.split(g))_=join(shift());eval(_) &lt;3</code></pre>
  <hr>
  <p>In case you were wondering, yeah, I used almost all the alphabet as variable names. This demo contains a big state machine needing all those variables. And yes, it's a heart at the end of the RegPacked code, because I had 3 bytes left and "eval(_) <3" is totally valid. It's useless but it's my way to say that the demo was made with love! :D
  <p>Cheers,
  <br><b>Xem</b>
  <br>
  <br>
  PS: <a href="https://twitter.com/js1k/status/569436901901520896" target=_blank style="font-size: 25px">please retweet if you liked it!</a>
</div>

</main>

</div>

<footer></footer>

<script src="../ui.js"></script>
<script>
header();
footer();
menu();
</script>

</body>
</html>